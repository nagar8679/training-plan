<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>××¤×œ×™×§×¦×™×™×ª ××™××•× ×™× â€“ ×“×©×‘×•×¨×“ ××œ×</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg-main: #020617;
      --bg-card: #020617;
      --bg-card-soft: #0b1220;
      --accent: #f97316;
      --accent-2: #38bdf8;
      --accent-3: #22c55e;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: #1e293b;
      --shadow-soft: 0 20px 50px rgba(0,0,0,0.75);
      --radius-lg: 18px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    a { color: inherit; text-decoration: none; }

    .app-shell {
      max-width: 1240px;
      margin: 0 auto;
      padding: 10px 10px 32px;
      display: grid;
      grid-template-columns: 220px 1fr;
      gap: 14px;
    }

    @media (max-width: 900px) {
      .app-shell {
        grid-template-columns: 1fr;
      }
    }

    /* ===== SIDE NAV ===== */
    .side-nav {
      background: radial-gradient(circle at top left, #020617, #020617 50%, #020617);
      border-radius: var(--radius-lg);
      padding: 14px 12px;
      border: 1px solid rgba(30,64,175,0.7);
      box-shadow: var(--shadow-soft);
      position: sticky;
      top: 10px;
      height: fit-content;
    }

    .side-nav-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .brand-logo {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: conic-gradient(from 210deg, #f97316, #facc15, #22c55e, #f97316);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 2px #020617, 0 0 20px rgba(249,115,22,0.7);
      font-weight: 800;
      color: #020617;
      font-size: 16px;
    }

    .side-nav-title h1 {
      margin: 0;
      font-size: 16px;
    }

    .side-nav-title h1 span {
      color: var(--accent);
    }

    .side-nav-title p {
      margin: 0;
      font-size: 11px;
      color: var(--text-muted);
    }

    .nav-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      margin: 8px 0 4px;
    }

    .nav-list {
      list-style: none;
      margin: 0;
      padding: 0;
      font-size: 13px;
    }

    .nav-item {
      border-radius: 999px;
      padding: 6px 10px;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 7px;
      cursor: pointer;
      color: var(--text-main);
      border: 1px solid transparent;
      transition: 0.15s ease-out;
    }

    .nav-item span.icon {
      font-size: 14px;
    }

    .nav-item.active {
      background: radial-gradient(circle at top left, #f97316, #ea580c);
      color: #020617;
      border-color: rgba(15,23,42,0.95);
      box-shadow: 0 0 0 1px rgba(15,23,42,0.9), 0 0 20px rgba(249,115,22,0.7);
      font-weight: 600;
    }

    .nav-item:hover:not(.active) {
      background: rgba(15,23,42,0.9);
      border-color: rgba(30,64,175,0.8);
    }

    .nav-footer {
      border-top: 1px solid #111827;
      margin-top: 10px;
      padding-top: 8px;
      font-size: 10px;
      color: var(--text-muted);
    }

    /* ===== MAIN CONTENT ===== */
    .main-content {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .top-bar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .top-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .top-title h2 {
      margin: 0;
      font-size: 18px;
    }

    .top-title p {
      margin: 0;
      font-size: 11px;
      color: var(--text-muted);
    }

    .top-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
    }

    .pill-stat {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.8);
      background: radial-gradient(circle at top, #020617, #020617 55%, #020617);
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      color: #e5e7eb;
    }

    .pill-stat span.icon {
      font-size: 13px;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .card {
      background: radial-gradient(circle at top left, #020617, #020617 60%, #020617);
      border-radius: var(--radius-lg);
      padding: 12px 12px 14px;
      border: 1px solid rgba(30,64,175,0.75);
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(248,113,113,0.14), transparent 60%);
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 10px;
    }

    .badge-live {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(22,163,74,0.16);
      border: 1px solid rgba(22,163,74,0.7);
      color: #bbf7d0;
      font-size: 11px;
      white-space: nowrap;
    }

    .badge-live span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34,197,94,0.35);
    }

    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .meta-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(55,65,81,0.85);
      color: #cbd5f5;
    }

    .meta-pill span.icon {
      font-size: 13px;
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
      font-size: 11px;
    }

    .controls-row label {
      color: #e5e7eb;
      font-weight: 500;
    }

    input[type="date"] {
      background: #020617;
      border-radius: 10px;
      border: 1px solid #1e293b;
      color: #e5e7eb;
      padding: 4px 8px;
      font-size: 11px;
      min-width: 140px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 5px 10px;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
    }

    .btn-main {
      background: var(--accent);
      color: #020617;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.9), 0 0 18px rgba(249,115,22,0.7);
    }

    .btn-main:hover {
      background: #ea580c;
    }

    .btn-ghost {
      background: rgba(15,23,42,0.96);
      color: var(--text-main);
      border: 1px solid rgba(55,65,81,0.9);
    }

    .btn-ghost:hover {
      border-color: rgba(96,165,250,0.9);
    }

    .btn-danger {
      background: rgba(220,38,38,0.96);
      color: #fee2e2;
      box-shadow: 0 0 0 1px rgba(127,29,29,0.9);
    }

    .btn-danger:hover {
      background: #b91c1c;
    }

    .day-strip {
      margin: 8px 0 10px;
      padding: 6px;
      border-radius: 999px;
      background: radial-gradient(circle at top left, rgba(15,23,42,0.98), rgba(15,23,42,0.98));
      border: 1px solid rgba(30,64,175,0.6);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .day-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .day-button {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 5px 12px;
      font-size: 12px;
      cursor: pointer;
      background: transparent;
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: 0.15s ease-out;
    }

    .day-button span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #475569;
    }

    .day-button.active {
      background: var(--accent);
      color: #020617;
      border-color: rgba(15,23,42,0.9);
      box-shadow: 0 0 0 1px rgba(15,23,42,0.9), 0 0 16px rgba(249,115,22,0.7);
    }

    .day-button.active span.dot {
      background: #020617;
    }

    .week-label {
      font-size: 11px;
      color: var(--text-muted);
    }

    .week-label span {
      color: var(--accent);
      font-weight: 600;
    }

    .info-text {
      font-size: 10px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(260px, 1.3fr);
      gap: 10px;
    }

    @media (max-width: 900px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    /* TABLE */
    .table-wrapper {
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #111827;
      background: radial-gradient(circle at top, rgba(15,23,42,0.98), rgba(15,23,42,0.98));
      margin-bottom: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    thead {
      background: #020617;
    }

    th, td {
      padding: 6px 6px;
      border-bottom: 1px solid rgba(31,41,55,0.9);
      text-align: center;
    }

    th {
      font-weight: 600;
      color: #cbd5f5;
      letter-spacing: 0.02em;
      background: linear-gradient(90deg, rgba(15,23,42,0.98), rgba(15,23,42,0.92));
    }

    tbody tr:nth-child(even) td { background: rgba(15,23,42,0.96); }
    tbody tr:nth-child(odd) td { background: rgba(15,23,42,0.98); }

    tbody tr:hover td {
      background: rgba(30,64,175,0.42);
    }

    td.name-col {
      text-align: right;
      font-weight: 500;
      font-size: 11px;
      color: #e5e7eb;
    }

    td.muscle-col {
      color: #c4b5fd;
      white-space: nowrap;
    }

    .badge-muscle {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(30,64,175,0.22);
      border: 1px solid rgba(59,130,246,0.6);
      font-size: 10px;
    }

    .badge-muscle span.dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: rgba(59,130,246,0.9);
    }

    .sets-dots {
      display: inline-flex;
      gap: 3px;
      justify-content: center;
    }

    .set-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      border: 1px solid #9ca3af;
      background: transparent;
      cursor: pointer;
    }

    .set-dot.active {
      background: var(--accent-3);
      border-color: #bbf7d0;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.7);
    }

    input[type="number"], input[type="text"] {
      width: 100%;
      max-width: 120px;
      background: #020617;
      border-radius: 8px;
      border: 1px solid #1f2937;
      color: var(--text-main);
      font-size: 11px;
      padding: 3px 6px;
    }

    input[type="number"]::placeholder,
    input[type="text"]::placeholder {
      color: #6b7280;
    }

    input[type="number"]:focus,
    input[type="text"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(249,115,22,0.45);
    }

    /* SIDE CARDS */
    .side-column {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .side-card {
      background: radial-gradient(circle at top right, #020617, #020617 55%, #020617);
      border-radius: var(--radius-lg);
      padding: 10px 10px 11px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(59,130,246,0.6);
      position: relative;
      overflow: hidden;
    }

    .side-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(56,189,248,0.2), transparent 60%);
      pointer-events: none;
    }

    .side-card-inner { position: relative; z-index: 1; }

    .side-card h3 {
      margin: 0 0 4px;
      font-size: 13px;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 5px;
    }

    .chip {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.98);
      color: #e5e7eb;
    }

    .tips-list {
      list-style: none;
      padding-right: 16px;
      margin: 0;
      font-size: 11px;
      color: #e5e7eb;
    }

    .tips-list li::before {
      content: "â€¢ ";
      color: var(--accent);
    }

    .tips-list li {
      margin-bottom: 3px;
    }

    .footer-note {
      text-align: center;
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .history-list {
      list-style: none;
      margin: 0;
      padding: 0;
      font-size: 11px;
      max-height: 150px;
      overflow-y: auto;
    }

    .history-item {
      border-radius: 8px;
      padding: 4px 6px;
      border: 1px solid #111827;
      background: rgba(15,23,42,0.92);
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .history-item span.label {
      color: #e5e7eb;
    }

    .history-item span.meta {
      color: var(--text-muted);
    }

    /* WORKOUT MODE */
    .workout-layout {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(260px, 1.3fr);
      gap: 10px;
    }
    @media (max-width: 900px) {
      .workout-layout { grid-template-columns: 1fr; }
    }

    .workout-main-title {
      font-size: 14px;
      margin: 0 0 6px;
    }

    .workout-ex-name {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 4px;
    }

    .workout-ex-muscle {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .workout-sets {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 12px;
      margin-bottom: 6px;
    }

    .workout-sets span.tag {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.9);
      background: rgba(15,23,42,0.96);
    }

    .workout-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      margin-bottom: 8px;
      font-size: 12px;
    }

    .timer-display {
      font-size: 18px;
      font-weight: 600;
      color: var(--accent-2);
    }

    .workout-steps {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .workout-list {
      font-size: 11px;
      max-height: 220px;
      overflow-y: auto;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .workout-list-item {
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid #111827;
      background: rgba(15,23,42,0.95);
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .workout-list-item.active {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(249,115,22,0.55);
    }

    /* EXERCISE LIBRARY */
    .exercise-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px;
      font-size: 12px;
    }

    .exercise-card {
      border-radius: 12px;
      padding: 8px;
      border: 1px solid #111827;
      background: radial-gradient(circle at top, #020617, #020617 65%, #020617);
    }

    .exercise-card h4 {
      margin: 0 0 2px;
      font-size: 13px;
    }

    .exercise-card .muscle {
      font-size: 11px;
      color: var(--accent-2);
      margin-bottom: 4px;
    }

    .exercise-card p {
      margin: 0;
      font-size: 11px;
      color: var(--text-muted);
    }

    /* HISTORY PAGE */
    .history-group {
      margin-bottom: 6px;
      border-radius: 10px;
      border: 1px solid #111827;
      background: rgba(15,23,42,0.96);
      padding: 6px 8px;
      font-size: 11px;
    }

    .history-group-title {
      font-weight: 600;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .history-group-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .history-group-list li {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 2px;
      color: var(--text-muted);
    }

    /* PR PAGE */
    .pr-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px;
      font-size: 12px;
    }

    .pr-card {
      border-radius: 12px;
      padding: 8px;
      border: 1px solid #111827;
      background: radial-gradient(circle at top, #020617, #020617 60%, #020617);
    }

    .pr-card h4 {
      margin: 0 0 2px;
      font-size: 13px;
    }

    .pr-value {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent-3);
    }

    .pr-meta {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* SETTINGS */
    .settings-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      font-size: 12px;
      margin-bottom: 6px;
    }

    .settings-row label {
      font-weight: 500;
    }

    select {
      background: #020617;
      border-radius: 999px;
      border: 1px solid #1f2937;
      color: #e5e7eb;
      font-size: 12px;
      padding: 4px 8px;
    }

    select:focus {
      outline: none;
      border-color: var(--accent-2);
      box-shadow: 0 0 0 1px rgba(56,189,248,0.6);
    }

    .small-note {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* EXPORT BUTTONS */
    .export-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
      font-size: 11px;
    }

  
  /* ==== Monochrome Black & White theme overrides with glow ==== */
  :root {
    --bg-main: #050505;
    --bg-card: #050505;
    --bg-card-soft: #101010;
    --accent: #f5f5f5;
    --accent-2: #e5e5e5;
    --accent-3: #d4d4d4;
    --text-main: #f5f5f5;
    --text-muted: #a3a3a3;
    --border-subtle: #262626;
  }

  body {
    background: radial-gradient(circle at top, #050505 0, #050505 40%, #000000 100%);
  }

  .nav-sidebar {
    background: radial-gradient(circle at top, #050505 0, #020202 60%, #000000 100%) !important;
    border-color: #262626 !important;
  }

  .card,
  .card-inner,
  .day-selector button,
  .btn-secondary {
    background: #050505 !important;
    border-color: #262626 !important;
  }

  .nav-item.active,
  .day-selector button.active,
  .btn-primary,
  .status-badge,
  .tag-pill,
  .progress-bar-fill {
    background: #f5f5f5 !important;
    color: #050505 !important;
    border-color: #f5f5f5 !important;
  }

  .section-title,
  .field-label,
  .kpi-label,
  .metric-value,
  .tag-pill-outline {
    color: #f5f5f5 !important;
  }

  canvas {
    filter: grayscale(1);
  }

  /* === Auth overlay layout (B/W Glow) === */
  #auth-screen {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    background: radial-gradient(circle at top, rgba(0,0,0,0.96), #000000);
    backdrop-filter: blur(6px);
    color: #f9fafb;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    direction: rtl;
  }
  .auth-shell {
    width: 100%;
    max-width: 980px;
    padding: 24px;
  }
  .auth-layout {
    position: relative;
    border-radius: 28px;
    overflow: hidden;
    background: linear-gradient(135deg, #050505, #111111);
    border: 1px solid rgba(249,249,249,0.08);
    box-shadow:
      0 26px 80px rgba(0,0,0,0.9),
      0 0 0 1px rgba(15,15,15,1);
    display: grid;
    grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.3fr);
  }
  @media (max-width: 780px) {
    .auth-layout {
      grid-template-columns: 1fr;
    }
    .auth-hero {
      display: none;
    }
  }
  .auth-layout::before,
  .auth-layout::after {
    content: "";
    position: absolute;
    border-radius: 999px;
    filter: blur(40px);
    opacity: 0.85;
    pointer-events: none;
  }
  .auth-layout::before {
    width: 260px;
    height: 260px;
    top: -80px;
    left: -80px;
    background: radial-gradient(circle, rgba(255,255,255,0.08), transparent 70%);
  }
  .auth-layout::after {
    width: 280px;
    height: 280px;
    bottom: -120px;
    right: -60px;
    background: radial-gradient(circle, rgba(255,255,255,0.12), transparent 70%);
  }
  .auth-hero {
    position: relative;
    padding: 30px 34px;
    border-left: 1px solid rgba(31,31,31,0.9);
    background: radial-gradient(circle at top left, #050505, #020202);
  }
  .auth-hero-title {
    font-size: 26px;
    margin: 0 0 10px;
    letter-spacing: 0.03em;
  }
  .auth-hero-title span {
    background: linear-gradient(135deg,#ffffff,#d4d4d4);
    -webkit-background-clip: text;
    color: transparent;
  }
  .auth-hero-sub {
    margin: 0 0 20px;
    font-size: 13px;
    color: #d4d4d4;
  }
  .auth-hero-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 18px;
  }
  .auth-pill {
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid rgba(229,229,229,0.35);
    font-size: 11px;
    color: #f5f5f5;
    background: rgba(10,10,10,0.9);
    backdrop-filter: blur(6px);
  }
  .auth-hero-foot {
    font-size: 11px;
    color: #a3a3a3;
  }
  .auth-panel {
    position: relative;
    padding: 30px 26px;
    background: radial-gradient(circle at top right, #111111, #020202);
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  .auth-logo {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: #a3a3a3;
  }
  .auth-logo span {
    color: #ffffff;
  }
  .auth-title-main {
    margin: 4px 0 4px;
    font-size: 20px;
    font-weight: 600;
  }
  .auth-title-sub {
    margin: 0;
    font-size: 12px;
    color: #d4d4d4;
  }
  .auth-form {
    margin-top: 8px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .auth-label {
    font-size: 12px;
    color: #e5e5e5;
    margin-bottom: 3px;
  }
  .auth-input {
    width: 100%;
    padding: 10px 11px;
    border-radius: 12px;
    border: 1px solid rgba(229,229,229,0.35);
    background: rgba(10,10,10,0.95);
    color: #f9fafb;
    font-size: 13px;
    outline: none;
    transition: 0.15s;
  }
  .auth-input::placeholder {
    color: #737373;
  }
  .auth-input:focus {
    border-color: rgba(249,249,249,0.9);
    box-shadow: 0 0 0 1px rgba(249,249,249,0.8);
    background: #050505;
  }
  .auth-btn-main {
    width: 100%;
    padding: 11px 12px;
    border-radius: 999px;
    border: none;
    background: linear-gradient(135deg,#ffffff,#e5e5e5);
    color: #050505;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    box-shadow:
      0 18px 55px rgba(0,0,0,0.9),
      0 0 0 1px rgba(24,24,27,1);
    transition: transform 0.12s ease-out, box-shadow 0.12s ease-out, background 0.12s;
  }
  .auth-btn-main:hover {
    transform: translateY(-1px);
    background: #ffffff;
    box-shadow:
      0 22px 70px rgba(0,0,0,1),
      0 0 0 1px rgba(39,39,42,1);
  }
  .auth-meta-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 11px;
    color: #a3a3a3;
  }
  .auth-link {
    color: #ffffff;
    text-decoration: underline;
    cursor: pointer;
  }
  .auth-error {
    font-size: 12px;
    color: #f97373;
    text-align: center;
    display: none;
  }
  .auth-small {
    font-size: 11px;
    color: #a3a3a3;
    text-align: center;
  }

    /* ==== Strong monochrome overrides for whole app ==== */
    html, body {
      background: radial-gradient(circle at top, #000000 0, #050505 45%, #000000 100%) !important;
      color: #f5f5f5 !important;
    }
    body {
      min-height: 100vh;
    }
    body, body * {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif !important;
    }
    .side-nav,
    .card,
    .day-strip,
    .workout-card,
    .nav-header,
    .nav-card,
    .summary-card,
    .kpi-card,
    .graph-card,
    .export-card,
    .notes-card {
      background: #050505 !important;
      border-color: #262626 !important;
      box-shadow: 0 22px 60px rgba(0,0,0,0.95) !important;
    }
    .day-button,
    .nav-item,
    .btn,
    .btn-primary,
    .btn-secondary,
    .btn-danger,
    .pill,
    .tag,
    .day-chip {
      background: #050505 !important;
      border-color: #404040 !important;
      color: #f5f5f5 !important;
    }
    .nav-item.active,
    .day-button.active,
    .btn-primary,
    .btn-primary:hover,
    .primary-chip {
      background: #f5f5f5 !important;
      color: #050505 !important;
      border-color: #f5f5f5 !important;
    }
    .progress-bar-inner,
    .weekly-progress-inner,
    .volume-bar-fill {
      background: #f5f5f5 !important;
    }
    input,
    select,
    textarea {
      background: #050505 !important;
      border-color: #404040 !important;
      color: #f5f5f5 !important;
    }
    input::placeholder,
    textarea::placeholder {
      color: #737373 !important;
    }

  /* global grayscale to kill any leftover colors */
  html {
    filter: grayscale(1);
  }
  body {
    background-color: #000000 !important;
  }
</style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBiFgNlgRkAAhZbRKEHHE4nLzKzbK0qBwg",
      authDomain: "training-planner-9a18e.firebaseapp.com",
      projectId: "training-planner-9a18e",
      storageBucket: "training-planner-9a18e.firebasestorage.app",
      messagingSenderId: "938674112974",
      appId: "1:938674112974:web:05ffbb8ca3d27746ea839f",
      measurementId: "G-1R38X0YDSE"
    };
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>

</head>
<body>
  <!-- ===== Auth Overlay ===== -->
  <div id="auth-screen">
    <div class="auth-shell">
      <div class="auth-layout">
        <section class="auth-panel">
          <div>
            <div class="auth-logo"><span>TP</span> â€¢ TRAINING</div>
            <h3 id="authTitle" class="auth-title-main">×”×ª×—×‘×¨×•×ª ×œ××¢×¨×›×ª</h3>
            <p id="authSubtitle" class="auth-title-sub">
              ×”×–×Ÿ ××™××™×™×œ ×•×¡×™×¡××” ×›×“×™ ×œ×”×™×›× ×¡ ×œ××¢×¨×›×ª ×”××™××•× ×™× ×”××™×©×™×ª ×©×œ×š ×‘×¢× ×Ÿ.
            </p>
          </div>

          <form class="auth-form" onsubmit="return false;">
            <div>
              <div class="auth-label">××™××™×™×œ</div>
              <input id="loginEmail" type="email" class="auth-input" placeholder="name@example.com">
            </div>
            <div>
              <div class="auth-label">×¡×™×¡××”</div>
              <input id="loginPass" type="password" class="auth-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button id="loginBtn" type="button" class="auth-btn-main" onclick="handleAuthClick()">×”××©×š ×œ××¢×¨×›×ª</button>
          </form>

          <div class="auth-meta-row">
            <span id="authSwitchText">××™×Ÿ ×œ×š ××©×ª××© ×¢×“×™×™×Ÿ?</span>
            <span class="auth-link" id="authSwitchLink">×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ×—×“×©</span>
          </div>

          <div class="auth-meta-row" style="margin-top:6px;">
            <span></span>
            <span class="auth-link" id="forgotPassLink">×©×›×—×ª×™ ×¡×™×¡××”</span>
          </div>

          <div id="authError" class="auth-error"></div>
          <div class="auth-small">×”×’×™×©×” ×œ××¢×¨×›×ª ×”×™× ××™×©×™×ª ×•××•×’× ×ª ×‘×¡×™×¡××” ×“×¨×š Firebase.</div>
        </section>

        <section class="auth-hero">
          <h2 class="auth-hero-title"><span>Training Planner</span></h2>
          <p class="auth-hero-sub">
            ××¢×¨×›×ª ××¡×•×“×¨×ª ×œ× ×™×”×•×œ ×ª×•×›× ×™×ª ×”××™××•× ×™× â€“ ×™××™×, ×ª×¨×’×™×œ×™×, ××©×§×œ×™× ×•×”×ª×§×“××•×ª â€“ ×¢× ×©××™×¨×” ×‘×¢× ×Ÿ.
          </p>
          <div class="auth-hero-pills">
            <div class="auth-pill">×ª×•×›× ×™×ª ×©×‘×•×¢×™×ª</div>
            <div class="auth-pill">××¢×§×‘ ××©×§×œ×™×</div>
            <div class="auth-pill">×¡×˜×™× ×•×—×–×¨×•×ª</div>
          </div>
          <p class="auth-hero-foot">
            ×”×ª×—×‘×¨ ×›×“×™ ×œ×”××©×™×š ×‘×“×™×•×§ ×××™×¤×” ×©×¢×¦×¨×ª, ××›×œ ××—×©×‘ ×©××—×•×‘×¨ ×œ×—×©×‘×•×Ÿ ×©×œ×š.
          </p>
        </section>
      </div>
    </div>
  </div>

  <div class="app-shell">
    <!-- SIDE NAV -->
    <aside class="side-nav">
      <div class="side-nav-header">
        <div class="brand-logo">TP</div>
        <div class="side-nav-title">
          <h1><span>Training</span> Planner</h1>
          <p>××¢×¨×›×ª ××œ××” ×œ××¢×§×‘ ××™××•× ×™ ×›×•×—</p>
        </div>
      </div>

      <div class="nav-section-title">× ×™×•×•×˜</div>
      <ul class="nav-list">
        <li class="nav-item active" data-page="dashboard">
          <span class="icon">ğŸ“Š</span> ×“×©×‘×•×¨×“ ×™×•××™
        </li>
        <li class="nav-item" data-page="workout">
          <span class="icon">ğŸ‹ï¸â€â™‚ï¸</span> ××¦×‘ ××™××•×Ÿ
        </li>
        <li class="nav-item" data-page="library">
          <span class="icon">ğŸ“˜</span> ×¡×¤×¨×™×™×ª ×ª×¨×’×™×œ×™×
        </li>
        <li class="nav-item" data-page="history">
          <span class="icon">ğŸ“…</span> ×™×•××Ÿ ××™××•× ×™×
        </li>
        <li class="nav-item" data-page="prs">
          <span class="icon">ğŸ…</span> ×©×™××™× ××™×©×™×™×
        </li>
        
        <li class="nav-item nav-owner-only" data-page="ownerPanel" style="display:none;">
          <span class="icon">ğŸ› ï¸</span> ×¤×× ×œ ×‘×¢×œ×™×
        </li>
        <li class="nav-item nav-trainer-only" data-page="trainerPanel" style="display:none;">
          <span class="icon">ğŸ§‘â€ğŸ«</span> ×¤×× ×œ ××××Ÿ
        </li><li class="nav-item" data-page="settings">
          <span class="icon">âš™ï¸</span> ×”×’×“×¨×•×ª
        </li>
      </ul>

      <div class="nav-footer">
        <div>×›×œ ×”× ×ª×•× ×™× × ×©××¨×™× ×›×¨×’×¢ ×‘×“×¤×“×¤×Ÿ ×©×œ×š (localStorage).<br>
        ×× ××ª×” ××—×•×‘×¨, ×”× ×ª×•× ×™× ××¡×•× ×›×¨× ×™× ×’× ×œ×¢× ×Ÿ (Firebase).</div>
        <div id="roleBadge" style="margin-top:6px;font-size:11px;color:#9ca3af;"></div>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
      <div class="top-bar">
        <div class="top-title">
          <h2 id="mainPageTitle">×“×©×‘×•×¨×“ ××™××•× ×™× ×©×‘×•×¢×™</h2>
          <p id="mainPageSubtitle">××¢×§×‘ ××©×§×œ×™×, ×¡×˜×™× ×•×”×ª×§×“××•×ª ×œ××•×¨×š ×–××Ÿ.</p>
        </div>
        <div class="top-pills">
          <div class="pill-stat"><span class="icon">ğŸ“†</span>6 ×™××™ ××™××•×Ÿ ×‘×©×‘×•×¢</div>
          <div class="pill-stat"><span class="icon">ğŸ“ˆ</span>××˜×¨×”: ×¢×œ×™×™×” ×”×“×¨×’×ª×™×ª ×‘×¢×•××¡</div>
          <div class="pill-stat"><span class="icon">ğŸ’¾</span>× ×©××¨ ××•×˜×•××˜×™×ª ×‘××›×©×™×¨ ×©×œ×š</div>
        </div>
      </div>

      <!-- DASHBOARD PAGE -->
      <section id="dashboard" class="page active">
        <div class="day-strip">
          <div class="day-buttons" id="dayButtons"></div>
          <div class="week-label">
            ×©×‘×•×¢ × ×•×›×—×™: <span>××¡×” / ×”×•×¨×“×ª ××—×•×– ×©×•××Ÿ</span><br />
            ×‘×—×¨ ×™×•×, ×¨×©×•× ××©×§×œ×™× â€“ ×”××¢×¨×›×ª ×ª×‘× ×” ×¢×‘×•×¨×š ×”×™×¡×˜×•×¨×™×” ×•×’×¨×£.
          </div>
        </div>

        <div class="grid-2">
          <section class="card">
            <div class="card-inner">
              <div class="card-header">
                <div>
                  <h3 id="dayTitle" style="margin:0;font-size:15px;">×™×•× ×¨××©×•×Ÿ â€“ ×—×–×” + ×›×ª×¤×™×™× + ×™×“ ××—×•×¨×™×ª</h3>
                  <p id="daySubtitle" style="margin:2px 0 0;font-size:11px;color:#fb923c;">
                    ×—×–×” ×›×‘×“ + ×›×ª×£ ×§×“××™×ª/×××¦×¢×™×ª + ×˜×¨×™×™×¡×¤×¡
                  </p>
                </div>
                <div class="badge-live">
                  <span class="dot"></span> ××™××•×Ÿ ×¤×¢×™×œ â€“ ×“×©×‘×•×¨×“
                </div>
              </div>

              <div class="meta-row">
                <div class="meta-pill"><span class="icon">ğŸ‹ï¸â€â™‚ï¸</span>×ª×¨×’×™×œ×™ ×‘×¡×™×¡ + ×‘×™×“×•×“</div>
                <div class="meta-pill"><span class="icon">â±</span>×× ×•×—×•×ª: 2â€“3 ×“×§' ×‘×¡×™×¡ / 60â€“90 ×©× ' ×‘×™×“×•×“</div>
                <div class="meta-pill"><span class="icon">ğŸ¯</span>×©××•×¨ ××©×§×œ×™× ××—×¨×™ ×›×œ ××™××•×Ÿ</div>
              </div>

              <div class="controls-row">
                <label for="workoutDate">×ª××¨×™×š ××™××•×Ÿ:</label>
                <input type="date" id="workoutDate" />
                <button class="btn btn-danger" id="resetDayBtn">ğŸ§¹ ××™×¤×•×¡ × ×ª×•× ×™ ×”×™×•×</button>
                <button class="btn btn-main" id="goWorkoutModeBtn">ğŸ‹ï¸â€â™‚ï¸ ××¢×‘×¨ ×œ××¦×‘ ××™××•×Ÿ</button>
              </div>

              <p class="info-text">
                ×›×œ ××©×§×œ/×”×¢×¨×” ×©××ª×” ××–×™×Ÿ × ×©××¨×™× ××•×˜×•××˜×™×ª ×œ×¤×™ ×™×•× ×•×ª××¨×™×š.  
                ×”×”×™×¡×˜×•×¨×™×” ××©××©×ª ×œ×’×¨×£, ×™×•××Ÿ ××™××•× ×™× ×•×©×™××™× ××™×©×™×™× (PRs).
              </p>

              <div class="table-wrapper">
                <table>
                  <thead>
                    <tr>
                      <th>×ª×¨×’×™×œ</th>
                      <th>×¡×˜×™× Ã— ×—×–×¨×•×ª</th>
                      <th>×§×‘×•×¦×ª ×©×¨×™×¨</th>
                      <th>×¡×˜×™× ×©×‘×•×¦×¢×•</th>
                      <th>××©×§×œ (×§×´×’)</th>
                      <th>×”×¢×¨×•×ª</th>
                    </tr>
                  </thead>
                  <tbody id="exerciseTableBody"></tbody>
                </table>
              </div>

              <h4 style="margin:6px 0 4px;font-size:12px;">×™×•××Ÿ ××™××•× ×™× ×œ×™×•× ×”× ×•×›×—×™</h4>
              <ul class="history-list" id="dayHistoryList"></ul>
            </div>
          </section>

          <aside class="side-column">
            <section class="side-card">
              <div class="side-card-inner">
                <h3>×˜×™×¤×™× ×—×©×•×‘×™× ×œ×”×ª×§×“××•×ª</h3>
                <div class="chip-row">
                  <div class="chip">Progressive Overload</div>
                  <div class="chip">×˜×›× ×™×§×” ×œ×¤× ×™ ××©×§×œ</div>
                  <div class="chip">×©×™× ×” ×•×ª×–×•× ×”</div>
                </div>
                <ul class="tips-list">
                  <li>××˜×¨×”: ×œ×¢×œ×•×ª ×‘×¢×•××¡ (××©×§×œ/×—×–×¨×•×ª/×¡×˜×™×) ×›×œ 1â€“2 ×©×‘×•×¢×•×ª ×‘×¦×•×¨×” ×—×›××”.</li>
                  <li>×‘×ª×¨×’×™×œ×™ ×‘×¡×™×¡ â€“ ×©×œ×™×˜×”, ×œ× ×œ×–×¨×•×§ ××©×§×œ. ×× ×”×˜×›× ×™×§×” × ×©×‘×¨×ª, ×œ×”×•×¨×™×“ ××©×§×œ.</li>
                  <li>×œ×”×©××™×¨ 1â€“3 ×—×–×¨×•×ª ×‘×¨×–×¨×‘×” ×‘×¨×•×‘ ×”×¡×˜×™× â€“ ×œ× ×—×™×™×‘×™× ×›×™×©×œ×•×Ÿ ×‘×›×œ ×¡×˜.</li>
                  <li>×—×œ×‘×•×Ÿ 1.6â€“2 ×’×¨× ×œ×›×œ ×§×´×’ ××©×§×œ ×’×•×£ + 2â€“3 ×œ×™×˜×¨ ××™× ×‘×™×•×.</li>
                  <li>×©×™× ×” ×˜×•×‘×” ×ª×™×ª×Ÿ ×™×•×ª×¨ ×ª×•×¦××•×ª ××¢×•×“ ×¡×˜ ××—×“ ×‘×¡×•×£ ××™××•×Ÿ ×©××ª×” ×’××•×¨ ×‘×•.</li>
                </ul>
                <p class="footer-note">
                  ×¢×§×‘×™×•×ª + ××¢×§×‘ ××¡×•×“×¨ = ×”×ª×§×“××•×ª.  
                  ×”××ª×¨ ×¨×§ ×¢×•×–×¨ ×œ×š ×œ×”×™×•×ª ××¡×•×“×¨ â€“ ×”×¢×‘×•×“×” ×‘×—×“×¨ ×”×›×•×©×¨ ğŸ’ª
                </p>
              </div>
            </section>

            <section class="side-card">
              <div class="side-card-inner">
                <h3>×’×¨×£ ×”×ª×§×“××•×ª â€“ ×œ×¤×™ ×ª×¨×’×™×œ</h3>
                <div class="controls-row" style="margin-bottom:4px;">
                  <label for="exerciseSelect">×‘×—×¨ ×ª×¨×’×™×œ ×œ×’×¨×£:</label>
                  <select id="exerciseSelect"></select>
                </div>
                <canvas id="progressChart" height="150"></canvas>
                <p class="small-note">
                  ×”×’×¨×£ ××¦×™×’ ××©×§×œ×™× ×œ××•×¨×š ×–××Ÿ ×¢×‘×•×¨ ×”×ª×¨×’×™×œ ×©× ×‘×—×¨ â€“ ×œ×¤×™ ×ª××¨×™×š ×”××™××•×Ÿ.
                </p>
                <div class="settings-row" style="margin-top:8px;gap:8px;flex-wrap:wrap;">
                  <button id="resetSelectedGraphBtn" class="btn ghost">ğŸ—‘ï¸ ××™×¤×•×¡ ×”×’×¨×£ ×œ×ª×¨×’×™×œ ×”× ×‘×—×¨</button>
                  <button id="resetAllGraphsBtn" class="btn danger">ğŸ“‰ ××™×¤×•×¡ ×›×œ ×”×’×¨×¤×™×</button>
                </div>
              </div>
            </section>
          </aside>
        </div>
      </section>

      <!-- WORKOUT MODE PAGE -->
      <section id="workout" class="page">
        <section class="card">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <h3 class="workout-main-title">××¦×‘ ××™××•×Ÿ â€“ ×‘×™×¦×•×¢ ×¡×˜×™× ×‘×–××Ÿ ×××ª</h3>
                <p style="margin:0;font-size:11px;color:#fb923c;">
                  ×‘×—×¨ ×™×•×, ×”×ª×—×œ ××™××•×Ÿ, ×¡××Ÿ ×¡×˜×™×, ×”×©×ª××© ×‘×˜×™×™××¨ ×× ×•×—×” ×•×”××¢×¨×›×ª ×ª×©××•×¨ ×œ×š ×”×›×œ.
                </p>
              </div>
              <div class="badge-live">
                <span class="dot"></span> ××¦×‘ ××™××•×Ÿ ×¤×¢×™×œ
              </div>
            </div>

            <div class="workout-layout">
              <div>
                <div class="controls-row">
                  <label>×™×•×:</label>
                  <select id="workoutDaySelect"></select>

                  <label>×ª××¨×™×š:</label>
                  <input type="date" id="workoutModeDate" />
                </div>

                <hr style="border:none;border-top:1px solid #111827;margin:6px 0;" />

                <div id="workoutCurrentContainer">
                  <p class="workout-ex-name" id="workoutExName">×œ× × ×‘×—×¨ ×ª×¨×’×™×œ ×¢×“×™×™×Ÿ</p>
                  <p class="workout-ex-muscle" id="workoutExMuscle"></p>
                  <div class="workout-sets">
                    <span class="tag" id="workoutSetsRepsTag">×¡×˜×™× Ã— ×—×–×¨×•×ª</span>
                    <span class="tag" id="workoutIndexTag">×ª×¨×’×™×œ 1 ××ª×•×š X</span>
                  </div>

                  <div class="workout-controls">
                    <label>×¡×˜ × ×•×›×—×™:</label>
                    <span id="currentSetLabel">1</span>
                    <button class="btn btn-main" id="finishSetBtn">âœ” ×¡×™×™××ª×™ ×¡×˜</button>
                    <button class="btn btn-ghost" id="nextExerciseBtn">â­ ×ª×¨×’×™×œ ×”×‘×</button>
                  </div>

                  <div class="workout-controls">
                    <label>××©×§×œ × ×•×›×—×™ (×§×´×’):</label>
                    <input type="number" id="workoutWeightInput" step="0.5" style="max-width:90px;" />
                    <button class="btn btn-ghost" id="saveWorkoutWeightBtn">ğŸ’¾ ×©××•×¨ ××©×§×œ</button>
                  </div>

                  <div class="workout-controls">
                    <label>×˜×™×™××¨ ×× ×•×—×” (×©× ×™×•×ª):</label>
                    <select id="restSelect">
                      <option value="60">60</option>
                      <option value="90" selected>90</option>
                      <option value="120">120</option>
                    </select>
                    <button class="btn btn-main" id="startRestBtn">â± ×”×ª×—×œ ×× ×•×—×”</button>
                    <span class="timer-display" id="restTimerDisplay">00:00</span>
                  </div>

                  <p class="workout-steps">
                    1. ×‘×—×¨ ×™×•× ×•×ª××¨×™×š.  
                    2. ×‘×—×¨ ×ª×¨×’×™×œ ××”×¦×“ ××• ×œ×—×¥ â€œ×ª×¨×’×™×œ ×”×‘×â€.  
                    3. ×¢×“×›×Ÿ ××©×§×œ, ×œ×—×¥ â€œ×¡×™×™××ª×™ ×¡×˜â€, ×•×”×©×ª××© ×‘×˜×™×™××¨ ×× ×•×—×”.  
                    4. ×”×›×œ × ×©××¨ ×œ×˜×‘×œ×”, ×œ×”×™×¡×˜×•×¨×™×” ×•×œ×©×™××™×.
                  </p>
                </div>
              </div>

              <aside class="side-card">
                <div class="side-card-inner">
                  <h3>×¨×©×™××ª ×”×ª×¨×’×™×œ×™× ×œ×™×•× ×”× ×•×›×—×™</h3>
                  <ul class="workout-list" id="workoutExerciseList"></ul>
                  <p class="small-note">
                    ×œ×—×¥ ×¢×œ ×ª×¨×’×™×œ ×‘×¨×©×™××” ×›×“×™ ×œ×¢×‘×•×¨ ××œ×™×•.  
                    ×©×“×•×ª ×”××©×§×œ ×•×”×¡×˜×™× ××¡×•× ×›×¨× ×™× ×¢× ×”×“×©×‘×•×¨×“ ×”×¨××©×™.
                  </p>
                </div>
              </aside>
            </div>
          </div>
        </section>
      </section>

      <!-- EXERCISE LIBRARY PAGE -->
      <section id="library" class="page">
        <section class="card">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <h3 style="margin:0;font-size:15px;">×¡×¤×¨×™×™×ª ×ª×¨×’×™×œ×™×</h3>
                <p style="margin:2px 0 0;font-size:11px;color:#fb923c;">
                  ×›×œ ×”×ª×¨×’×™×œ×™× ××”×ª×•×›× ×™×ª ×©×œ×š â€“ ×¢× ×§×‘×•×¦×ª ×©×¨×™×¨ ×•×”×¡×‘×¨ ×§×¦×¨ ×œ×‘×™×¦×•×¢.
                </p>
              </div>
            </div>

            <div class="exercise-grid" id="exerciseLibraryGrid"></div>
          </div>
        </section>
      </section>

      <!-- HISTORY PAGE -->
      <section id="history" class="page">
        <section class="card">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <h3 style="margin:0;font-size:15px;">×™×•××Ÿ ××™××•× ×™× ××œ×</h3>
                <p style="margin:2px 0 0;font-size:11px;color:#fb923c;">
                  ×›×œ ×”××™××•× ×™× ×©×œ×š ×œ×¤×™ ×ª××¨×™×š, ×™×•× ×•×ª×¨×’×™×œ â€“ × ×‘× ×” ××•×˜×•××˜×™×ª ××”× ×ª×•× ×™×.
                </p>
              </div>
            </div>

            <div class="export-row">
              <button class="btn btn-main" id="exportCsvBtn">ğŸ“Š ×™×™×¦×•× ×œ××§×¡×œ (CSV)</button>
              <span class="small-note">
                ×”×§×•×‘×¥ ×™×›×™×œ: ×™×•×, ×ª××¨×™×š, ×ª×¨×’×™×œ, ××©×§×œ ×•×©×¢×” ×©× ×©××¨.
              </span>
            </div>

            <div id="historyContainer"></div>
          </div>
        </section>
      </section>

      <!-- PRS PAGE -->
      <section id="prs" class="page">
        <section class="card">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <h3 style="margin:0;font-size:15px;">×©×™××™× ××™×©×™×™× (PRs)</h3>
                <p style="margin:2px 0 0;font-size:11px;color:#fb923c;">
                  ×œ×›×œ ×ª×¨×’×™×œ â€“ ×”××©×§×œ ×”×›×™ ×’×‘×•×” ×©×¢×©×™×ª ××™ ×¤×¢× + ×ª××¨×™×š ×”×©×™×.
                </p>
              </div>
            </div>

            <div class="pr-grid" id="prGrid"></div>
          </div>
        </section>
      </section>

      <!-- OWNER PANEL PAGE -->
      <section id="ownerPanel" class="page">
        <section class="card">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <h3 style="margin:0;font-size:15px;">×¤×× ×œ ×‘×¢×œ×™×</h3>
                <p style="margin:2px 0 0;font-size:11px;color:#fb923c;">
                  × ×™×”×•×œ ××©×ª××©×™×, ×ª×¤×§×™×“×™× ×•× ×ª×•× ×™ ××ª××× ×™× â€“ ×”×›×•×œ ××ª×•×š ×”××ª×¨.
                </p>
              </div>
            </div>

            <div class="settings-row">
              <label>××™××™×™×œ ××—×•×‘×¨:</label>
              <span id="ownerEmailLabel">-</span>
            </div>

            <div class="settings-row">
              <label>×ª×¤×§×™×“ ×‘××¢×¨×›×ª:</label>
              <span id="ownerRoleLabel">××ª×××Ÿ</span>
            </div>

            <div class="settings-row" style="margin-top:12px;gap:8px;flex-wrap:wrap;">
              <button id="ownerRefreshUsersBtn" class="btn primary">×¨×¢× ×Ÿ ×¨×©×™××ª ××©×ª××©×™×</button>
              <button id="ownerCreateUserBtn" class="btn ghost">×™×¦×™×¨×ª ××©×ª××© ×—×“×©</button>
            </div>

            <p class="small-note" style="margin-top:6px;">
              ×›×œ ×”×¤×¢×•×œ×•×ª ×›××Ÿ ××©×¤×™×¢×•×ª ×¢×œ ××©×ª××©×™× ×××ª×™×™× â€“ ××•××œ×¥ ×œ×”×©×ª××© ×‘×–×” ×‘×–×”×™×¨×•×ª.
            </p>

            <div id="ownerUsersTableContainer" class="table-container" style="margin-top:12px;max-height:360px;overflow:auto;"></div>
          </div>
        </section>
      </section>

      <!-- TRAINER PANEL PAGE -->
      <section id="trainerPanel" class="page">
        <section class="card">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <h3 style="margin:0;font-size:15px;">×¤×× ×œ ××××Ÿ</h3>
                <p style="margin:2px 0 0;font-size:11px;color:#fb923c;">
                  ×¦×¤×™×™×” ×‘××ª××× ×™× ×”××©×•×™×›×™× ××œ×™×š, ××¦×‘ ×›×œ×œ×™ ×©×œ×”× ×•×’×™×©×” ×œ× ×ª×•× ×™ ×”××™××•× ×™× ××”×¢× ×Ÿ.
                </p>
              </div>
            </div>

            <div id="trainerTraineesContainer" style="margin-top:8px;">
              <p class="small-note">×›××Ÿ ×ª×•×¤×™×¢ ×¨×©×™××ª ×”××ª××× ×™× ×”××©×•×™×§×™× ××œ×™×š ××ª×•×š ×”××¢×¨×›×ª.</p>
            </div>

            <div id="trainerTraineeDetailsContainer" style="margin-top:12px; display:none;">
              <section class="card" style="padding:8px;border-color:#111827;">
                <div class="card-inner">
                  <div class="card-header">
                    <div>
                      <h4 style="margin:0;font-size:13px;">× ×ª×•× ×™ ××ª×××Ÿ</h4>
                      <p style="margin:2px 0 0;font-size:11px;color:#9ca3af;">
                        ×ª×¦×•×’×” ×˜×›× ×™×ª ×©×œ ××¦×‘ ×”××™××•× ×™× ××”×¢× ×Ÿ (training_states) â€“ ×œ×§×¨×™××” ×‘×œ×‘×“.
                      </p>
                    </div>
                    <button id="trainerCloseDetailsBtn" class="btn btn-ghost" style="font-size:11px;padding:4px 8px;">×¡×’×•×¨</button>
                  </div>
                  <pre id="trainerTraineeDetailsPre" style="margin-top:6px;max-height:240px;overflow:auto;font-size:11px;direction:ltr;text-align:left;background:#020617;border-radius:8px;padding:8px;"></pre>
                </div>
              </section>
            </div>
          </div>
        </section>
      </section>

      <!-- SETTINGS PAGE -->
      <section id="settings" class="page">
        <section class="card">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <h3 style="margin:0;font-size:15px;">×”×’×“×¨×•×ª</h3>
                <p style="margin:2px 0 0;font-size:11px;color:#fb923c;">
                  ×©×œ×™×˜×” ×¢×œ ×–×× ×™ ×× ×•×—×”, ×¢×™×¦×•×‘ ×‘×¡×™×¡×™ ×•××™×¤×•×¡ × ×ª×•× ×™×.
                </p>
              </div>
            </div>

            <div class="settings-row">
              <label for="defaultRestSelect">×–××Ÿ ×× ×•×—×” ×‘×¨×™×¨×ª ××—×“×œ (××¦×‘ ××™××•×Ÿ):</label>
              <select id="defaultRestSelect">
                <option value="60">60 ×©× ×™×•×ª</option>
                <option value="90">90 ×©× ×™×•×ª</option>
                <option value="120">120 ×©× ×™×•×ª</option>
              </select>
            </div>
            <p class="small-note">
              ×”×”×’×“×¨×” ×”×–×• ×ª×©×¤×™×¢ ×¢×œ ×”×˜×™×™××¨ ×‘××¦×‘ ××™××•×Ÿ. × ×™×ª×Ÿ ×œ×©× ×•×ª ×’× ××©× ×™×“× ×™×ª.
            </p>

            <hr style="border:none;border-top:1px solid #111827;margin:10px 0;">

            <div class="settings-row">
              <button class="btn btn-danger" id="resetAllDataBtn">ğŸ§¨ ××™×¤×•×¡ ×›×œ ×”× ×ª×•× ×™× (×›×œ ×”×™××™× ×•×”×ª××¨×™×›×™×)</button>
            </div>
            <p class="small-note">
              ×¤×¢×•×œ×” ×–×• ×ª××—×§ ××ª ×›×œ ×”××©×§×œ×™×, ×”×”×¢×¨×•×ª, ×”×”×™×¡×˜×•×¨×™×” ×•×”×©×™××™× (PRs) ××”××›×©×™×¨ ×”×–×” ×‘×œ×‘×“.  
              (×‘×¢×ª×™×“ ×›×©× ×—×‘×¨ ×œ×¢× ×Ÿ â€“ × ×•×›×œ ×œ×¢×©×•×ª ××™×¤×•×¡ ×¢× ×Ÿ × ×¤×¨×“.)
            </p>
          </div>
        </section>
      </section>
    </main>
  </div>

<script>
  // ===== DATA MODEL =====
  const program = {
    sunday: {
      title: "×™×•× ×¨××©×•×Ÿ â€“ ×—×–×” + ×›×ª×¤×™×™× + ×™×“ ××—×•×¨×™×ª",
      subtitle: "×—×–×” ×›×‘×“ + ×›×ª×£ ×§×“××™×ª/×××¦×¢×™×ª + ×˜×¨×™×™×¡×¤×¡",
      exercises: [
        {
          name: "×œ×—×™×¦×ª ×—×–×” ×‘××•×˜ (×‘× ×¥')",
          muscle: "×—×–×”",
          sets: 4, reps: "6â€“8",
          description: "×ª×¨×’×™×œ ×‘×¡×™×¡ ×œ×—×–×” ×××¦×¢×™ ×•×ª×—×ª×•×Ÿ. ×œ×©×›×‘ ×™×¦×™×‘, ×©×›××•×ª ××›×•×•×¦×•×ª ×œ××—×•×¨, ×œ×”×•×¨×™×“ ××ª ×”××•×˜ ×‘×©×œ×™×˜×” ×¢×“ ×§×¨×•×‘ ×œ×—×–×” ×•×œ×“×—×•×£ ×—×–×§ ××¢×œ×”."
        },
        {
          name: "×œ×—×™×¦×ª ×—×–×” ×‘×©×™×¤×•×¢ ×¢×œ×™×•×Ÿ ×¢× ×“×××‘×œ×™×",
          muscle: "×—×–×” ×¢×œ×™×•×Ÿ",
          sets: 4, reps: "8â€“10",
          description: "×œ×—×™×¦×” ×‘×–×•×•×™×ª 30Â° ×¢× ×“×××‘×œ×™× ×›×“×™ ×œ×¢×‘×•×“ ×¢×œ ×”×—×–×” ×”×¢×œ×™×•×Ÿ. ×œ×©××•×¨ ×¢×œ ×©×œ×™×˜×” ××œ××” ×•×ª× ×•×¢×” ×‘×§×©×ª ×˜×‘×¢×™×ª."
        },
        {
          name: "×¤×¨×¤×¨ ×‘××›×•× ×” ×œ×—×–×”",
          muscle: "×—×–×” ×××¦×¢×™",
          sets: 3, reps: "12â€“15",
          description: "×‘×™×“×•×“ ×œ×—×–×”. ×œ×¡×’×•×¨ ××ª ×”×™×“×™×™× ×¢×“ ×©×”×Ÿ ×›××¢×˜ × ×•×’×¢×•×ª, ×œ×¢×¦×•×¨ ×©× ×™×™×” ×‘×›×™×•×•×¥ ×•×œ×©×—×¨×¨ ×‘××™×˜×™×•×ª."
        },
        {
          name: "×§×¨×•×¡ ××•×‘×¨ ××œ××¢×œ×” ×œ××˜×” (×¤×•×œ×™ ×¢×œ×™×•×Ÿ)",
          muscle: "×—×–×” ×ª×—×ª×•×Ÿ",
          sets: 3, reps: "12â€“15",
          description: "×œ××©×•×š ××ª ×”×›×‘×œ×™× ×‘××œ×›×¡×•×Ÿ ××œ××¢×œ×” ×œ××˜×”, ××¨×¤×§×™× ××¢×˜ ×›×¤×•×¤×™×, ×œ×¡×™×™× ×‘×¢×¨×š ×‘×’×•×‘×” ×‘×˜×Ÿ ×¢×œ×™×•× ×”."
        },
        {
          name: "×œ×—×™×¦×ª ×›×ª×¤×™×™× ×‘××›×•× ×”",
          muscle: "×›×ª×£ ×§×“××™×ª",
          sets: 3, reps: "8â€“10",
          description: "×œ×—×™×¦×ª ×›×ª×¤×™×™× ×‘×™×©×™×‘×”. ×”×™×“×™×™× ××ª×—×™×œ×•×ª ×‘×¢×¨×š ×‘×’×•×‘×” ×›×ª×£, ×œ×“×—×•×£ ×œ××¢×œ×” ×‘×œ×™ ×œ× ×¢×•×œ ××¨×¤×§×™×."
        },
        {
          name: "×”×¨×—×§×ª ×›×ª×¤×™×™× ×œ×¦×“×“×™× ×¢× ×“×××‘×œ×™×",
          muscle: "×›×ª×£ ×××¦×¢×™×ª",
          sets: 3, reps: "12â€“15",
          description: "×œ×”×¨×™× ××ª ×”×“×××‘×œ×™× ×œ×¦×“×“×™× ×¢×“ ×’×•×‘×” ×”×›×ª×£ ×‘×œ×‘×“, ××¨×¤×§×™× ××¢×˜ ×›×¤×•×¤×™×, ×©×œ×™×˜×” ×•×œ× ×ª× ×•×¤×”."
        },
        {
          name: "×¤×©×™×˜×ª ××¨×¤×§×™× ××¢×œ ×”×¨××© ×¢× ×“×××‘×œ",
          muscle: "×™×“ ××—×•×¨×™×ª â€“ ×¨××© ××¨×•×š",
          sets: 3, reps: "10â€“12",
          description: "×™×©×™×‘×” ××• ×¢××™×“×”, ×“×××‘×œ ××—×“ ×‘×©×ª×™ ×™×“×™×™× ××¢×œ ×”×¨××©. ×œ×¨×“×ª ×¢××•×§ ×××—×•×¨×™ ×”×¨××© ×•×œ×™×™×©×¨ ×‘×©×§×˜."
        },
        {
          name: "×¤×©×™×˜×ª ××¨×¤×§×™× ×‘×—×‘×œ ×‘×¤×•×œ×™ ×¢×œ×™×•×Ÿ",
          muscle: "×™×“ ××—×•×¨×™×ª â€“ ×¨××© ×¦×“×“×™",
          sets: 3, reps: "12â€“15",
          description: "×œ×¢××•×“ ×¦××•×“ ×œ×¤×•×œ×™, ××¨×¤×§×™× ×œ×™×“ ×”×’×•×£, ×œ×“×—×•×£ ××ª ×”×—×‘×œ ×œ××˜×” ×•×œ×¤×ª×•×— ××•×ª×• ×‘×¡×•×£ ×”×˜×•×•×—."
        }
      ]
    },
    monday: {
      title: "×™×•× ×©× ×™ â€“ ×’×‘ + ×™×“ ×§×“××™×ª + ×××•×ª",
      subtitle: "×’×‘ ××œ× â€“ ×¨×•×—×‘, ×¢×•×‘×™, ×¢×œ×™×•×Ÿ ×•×ª×—×ª×•×Ÿ + ×‘×™×™×¡×¤×¡",
      exercises: [
        {
          name: "××ª×— ×‘××—×™×–×” ×¨×—×‘×”",
          muscle: "×’×‘ ×¨×—×‘",
          sets: 4, reps: "6â€“8 / 8â€“10",
          description: "×œ×ª×¤×•×¡ ×¨×—×‘ ××¢×˜ ××›×ª×£, ×œ××©×•×š ××ª ×‘×™×ª ×”×—×–×” ×œ×›×™×•×•×Ÿ ×”××•×˜, ×œ×—×©×•×‘ ×¢×œ ××©×™×›×” ×¢× ×”××¨×¤×§×™× ×œ××˜×”."
        },
        {
          name: "×—×ª×™×¨×” ×œ××•×˜ T",
          muscle: "×’×‘ ×××¦×¢×™/×¢×•×‘×™",
          sets: 4, reps: "8â€“10",
          description: "×¤×œ×’ ×’×•×£ ×¢×œ×™×•×Ÿ × ×•×˜×” ×§×“×™××”, ×’×‘ × ×™×˜×¨×œ×™, ×œ××©×•×š ××ª ×”×™×“×™×•×ª ×œ×›×™×•×•×Ÿ ×”×‘×˜×Ÿ ×ª×•×š ×©××™×¨×” ×¢×œ ×’×‘ ×—×–×§."
        },
        {
          name: "×—×ª×™×¨×” ×‘×™×©×™×‘×” ×‘×¤×•×œ×™ ×ª×—×ª×•×Ÿ",
          muscle: "×’×‘ ×××¦×¢×™",
          sets: 3, reps: "10â€“12",
          description: "×œ×©×‘×ª ×–×§×•×£, ×œ××©×•×š ××ª ×”×™×“×™×•×ª ×œ×›×™×•×•×Ÿ ×”×‘×˜×Ÿ, ×œ×”×—×–×™×§ ×©× ×™×™×” ×‘×›×™×•×•×¥ ×•×œ×©×—×¨×¨ ×œ××˜ ×§×“×™××”."
        },
        {
          name: "×¤×¨×¤×¨ ×”×¤×•×š ×‘××›×•× ×”/×¤×•×œ×™",
          muscle: "×’×‘ ×¢×œ×™×•×Ÿ + ×›×ª×£ ××—×•×¨×™×ª",
          sets: 3, reps: "12â€“15",
          description: "×œ×¤×ª×•×— ××ª ×”×™×“×™×™× ×œ××—×•×¨ ×¢×“ ×’×•×‘×” ×›×ª×£, ×œ×©××•×¨ ×¢×œ ×—×–×” ×§×“×™××” ×•×¢×œ ×ª× ×•×¢×” ××‘×•×§×¨×ª."
        },
        {
          name: "×¤×©×™×˜×ª ×’×‘ ×‘×›×™×¡× ×¨×•××™",
          muscle: "×’×‘ ×ª×—×ª×•×Ÿ",
          sets: 3, reps: "12â€“15",
          description: "×œ×›×•×¤×£ ××ª ×”×’×•×£ ×œ××˜×” ×‘××™×˜×™×•×ª ×•×œ×¢×œ×•×ª ×¢×“ ×§×• ×™×©×¨ ×¢× ×”×’×•×£, ×œ× ××¢×‘×¨ ×•×œ× ×œ× ×¢×•×œ ×’×‘."
        },
        {
          name: "×›×¤×™×¤×•×ª ××¨×¤×§×™× ×‘×¢××™×“×”",
          muscle: "×™×“ ×§×“××™×ª",
          sets: 3, reps: "10â€“12",
          description: "×œ×¢××•×“ ×™×¦×™×‘, ××¨×¤×§×™× ×¦××•×“×™× ×œ×’×•×£, ×œ×”×¢×œ×•×ª ×•×œ×¨×“×ª ×‘××™×˜×™×•×ª ×‘×œ×™ × ×¤× ×•×£."
        },
        {
          name: "×›×¤×™×¤×•×ª ×¤×˜×™×©×™× ×¢× ×“×××‘×œ×™×",
          muscle: "×™×“ ×§×“××™×ª (×‘×¨×›×™××œ×™×¡)",
          sets: 3, reps: "12",
          description: "××—×™×–×” × ×™×˜×¨×œ×™×ª (×›××™×œ×• ××—×–×™×§ ×¤×˜×™×©), ××¢×œ×” ×¢×“ ×–×•×•×™×ª 90â€“120Â° ×•×©×•×œ×˜ ×‘×™×¨×™×“×”."
        },
        {
          name: "×›×¤×™×¤×ª ×©×•×¨×© ×›×£ ×”×™×“ ×”×¤×•×›×”",
          muscle: "×××•×ª",
          sets: 3, reps: "12â€“15",
          description: "×œ×©×‘×ª, ×××•×ª ××•× ×—×•×ª, ×’×‘ ×›×£ ×”×™×“ ×œ××¢×œ×”, ×œ×”×¨×™× ××ª ×”××©×§×œ ×‘×¢×–×¨×ª ×©×•×¨×© ×›×£ ×”×™×“ ×‘×œ×‘×“."
        }
      ]
    },
    tuesday: {
      title: "×™×•× ×©×œ×™×©×™ â€“ ×¨×’×œ×™×™× + ×œ×™×‘×”",
      subtitle: "×¨×’×œ×™×™× ××œ××•×ª â€“ ×§×•×•××“×¨×™×¡×¤×¡, ××—×•×¨×™ ×”×™×¨×š, ×™×©×‘×Ÿ ×•×ª××•××™×",
      exercises: [
        {
          name: "×”××§×˜ ×¡×§×•×•××˜ ×‘××›×•× ×”",
          muscle: "×§×•×•××“ + ×™×©×‘×Ÿ",
          sets: 4, reps: "8â€“10",
          description: "×œ×¢××•×“ × ×›×•×Ÿ ×¢×œ ×”×¤×œ×˜×”, ×œ×¨×“×ª ×¢××•×§ ×ª×•×š ×©××™×¨×” ×¢×œ ×’×‘ ×¦××•×“ ×œ××©×¢× ×ª, ×œ× ×œ×™×™×©×¨ ×‘×¨×›×™×™× ×¢×“ ×”×¡×•×£."
        },
        {
          name: "×œ×—×™×¦×ª ×¨×’×œ×™×™× ×‘××›×•× ×”",
          muscle: "×›×œ ×”×¨×’×œ",
          sets: 4, reps: "10â€“12",
          description: "×¨×’×œ×™×™× ×‘×¨×•×—×‘ ×›×ª×¤×™×™×, ×œ×¤×ª×•×— ××¢×˜ ×”×—×•×¦×”, ×œ×¨×“×ª ×¢××•×§ ×•×œ×“×—×•×£ ×‘×©×œ×™×˜×”."
        },
        {
          name: "×¤×©×™×˜×ª ×‘×¨×›×™×™× ×‘××›×•× ×”",
          muscle: "×§×•×•××“×¨×™×¡×¤×¡",
          sets: 3, reps: "12â€“15",
          description: "×œ×™×™×©×¨ ××ª ×”×¨×’×œ×™×™× ×¢×“ ×›××¢×˜ × ×¢×™×œ×”, ×œ×¢×¦×•×¨ ×©× ×™×™×” ×‘×›×™×•×•×¥ ×•×œ×©×—×¨×¨ ×‘××™×˜×™×•×ª."
        },
        {
          name: "×›×¤×™×¤×ª ×‘×¨×›×™×™× ×‘×¢××™×“×”/××›×•× ×”",
          muscle: "××—×•×¨×™ ×”×™×¨×š",
          sets: 3, reps: "12â€“15",
          description: "×œ×›×•×¤×£ ××ª ×”×‘×¨×š ×›× ×’×“ ×”×ª× ×’×“×•×ª, ×œ×”×¨×’×™×© ××ª ××—×•×¨×™ ×”×™×¨×š, ×œ×©×—×¨×¨ ×œ××˜."
        },
        {
          name: "×“×“×œ×™×¤×˜ ×¨×•×× ×™ (RDL)",
          muscle: "×™×©×‘×Ÿ + ××¡×˜×¨×™× ×’",
          sets: 3, reps: "8â€“10",
          description: "×’×‘ ×™×©×¨, ×‘×¨×›×™×™× ×—×¦×™ ×›×¤×•×¤×•×ª, ×œ×”×•×¨×™×“ ××ª ×”××©×§×œ ×œ××•×¨×š ×”×¨×’×œ×™×™× ×¢×“ ××ª×™×—×” ×—×–×§×” ×‘××—×•×¨×™ ×”×™×¨×š."
        },
        {
          name: "×”×¨××ª ×¢×§×‘×™× ×‘×œ×—×™×¦×ª ×¨×’×œ×™×™×",
          muscle: "×ª××•××™× ×¢×œ×™×•×Ÿ",
          sets: 3, reps: "12â€“20",
          description: "×‘×™×©×™×‘×” ×‘××›×•× ×” ××• ×¢×œ ×”×¤×œ×˜×”, ×œ×”×•×¨×™×“ ××ª ×”×¢×§×‘×™× ×¢××•×§ ×•×œ×¢×œ×•×ª ×›××” ×©×™×•×ª×¨ ×’×‘×•×”."
        },
        {
          name: "×”×¨××ª ×¢×§×‘×™× ×‘×™×©×™×‘×” ×‘××›×•× ×”",
          muscle: "×ª××•××™× ×ª×—×ª×•×Ÿ",
          sets: 3, reps: "12â€“20",
          description: "×™×©×™×‘×”, ××©×§×œ ×¢×œ ×”×‘×¨×›×™×™×, ×¢×‘×•×“×” ××™×˜×™×ª ×•××‘×•×§×¨×ª ×‘×˜×•×•×— ××œ×."
        },
        {
          name: "×›×¤×™×¤×•×ª ×‘×˜×Ÿ ×‘××›×•× ×”",
          muscle: "×œ×™×‘×”",
          sets: 3, reps: "15",
          description: "×œ×›×•×•×¥ ××ª ×”×‘×˜×Ÿ ×•×œ× ×œ××©×•×š ×‘×™×“×™×™×, ×œ×”×•×¦×™× ××•×•×™×¨ ×‘×–××Ÿ ×”×›×™×•×•×¥."
        }
      ]
    },
    wednesday: {
      title: "×™×•× ×¨×‘×™×¢×™ â€“ ×—×–×” + ×›×ª×£ ×§×“××™×ª + ×›×ª×£ ×××¦×¢×™×ª + ×™×“ ××—×•×¨×™×ª",
      subtitle: "×©×™×œ×•×‘ × ×•×¡×£ ×œ×—×–×” + ×›×ª×¤×™×™× + ×˜×¨×™×™×¡×¤×¡",
      exercises: [
        {
          name: "×œ×—×™×¦×ª ×—×–×” ×‘×©×™×¤×•×¢ ×—×™×•×‘×™ ×¢× ×“×××‘×œ×™×",
          muscle: "×—×–×” ×¢×œ×™×•×Ÿ",
          sets: 4, reps: "8â€“10",
          description: "×›××• ×‘×™×•× ×¨××©×•×Ÿ â€“ ×“×’×© ×¢×œ ×—×–×” ×¢×œ×™×•×Ÿ, ×©×œ×™×˜×” ×‘×–×•×•×™×ª ×•×™×¦×™×‘×•×ª ×‘×›×ª×¤×™×™×."
        },
        {
          name: "×œ×—×™×¦×ª ×—×–×” ×‘×¢××™×“×” ×¢× ×›×‘×œ×™×",
          muscle: "×—×–×” ×××¦×¢×™/×ª×—×ª×•×Ÿ",
          sets: 3, reps: "10â€“12",
          description: "×œ×¢××•×“ ×‘×××¦×¢, ×œ××©×•×š ××ª ×”×™×“×™×•×ª ×§×“×™××” ×•×œ×¡×’×•×¨ ×‘×§×• ×—×–×”, ×©×œ×™×˜×” ××œ××” ×‘×›×œ ×”×˜×•×•×—."
        },
        {
          name: "×¤×¨×¤×¨ ×¢× ×›×‘×œ×™× ×‘×™×©×™×‘×”",
          muscle: "×—×–×” ×××¦×¢×™",
          sets: 3, reps: "12â€“15",
          description: "×‘×™×“×•×“ ×—×–×§, ×œ×©××•×¨ ×¢×œ ××¨×¤×§×™× ××¢×˜ ×›×¤×•×¤×™×, ×œ×¢×¦×•×¨ ×‘×©×™× ×”×›×™×•×•×¥."
        },
        {
          name: "×œ×—×™×¦×ª ×›×ª×¤×™×™× ×¢× ×“×××‘×œ×™×",
          muscle: "×›×ª×£ ×§×“××™×ª + ×××¦×¢×™×ª",
          sets: 3, reps: "8â€“10",
          description: "×™×©×™×‘×” ×–×§×•×¤×”, ×“×××‘×œ×™× ×‘×¦×“ ×”×¨××©, ×œ×“×—×•×£ ×œ××¢×œ×” ×‘×œ×™ × ×¢×™×œ×” ×—×“×”."
        },
        {
          name: "×”×¨×—×§×ª ×›×ª×¤×™×™× ×œ×¦×“×“×™×",
          muscle: "×›×ª×£ ×××¦×¢×™×ª",
          sets: 3, reps: "12â€“15",
          description: "×›××• ×‘×™×•× ×¨××©×•×Ÿ â€“ ×“×’×© ×¢×œ ×¨×•×—×‘ ×›×ª×£."
        },
        {
          name: "×¤×©×™×˜×ª ××¨×¤×§×™× ××¢×œ ×”×¨××© ×¢× ×“×××‘×œ",
          muscle: "×™×“ ××—×•×¨×™×ª â€“ ×¨××© ××¨×•×š",
          sets: 3, reps: "10â€“12",
          description: "×›××• ×‘×™×•× ×¨××©×•×Ÿ â€“ ×“×’×© ×¢×œ ×¨××© ××¨×•×š ×©×œ ×”×˜×¨×™×™×¡×¤×¡."
        },
        {
          name: "×¤×©×™×˜×ª ××¨×¤×§×™× ×‘×—×‘×œ ×‘×¤×•×œ×™ ×¢×œ×™×•×Ÿ",
          muscle: "×™×“ ××—×•×¨×™×ª â€“ ×¨××© ×¦×“×“×™",
          sets: 3, reps: "12â€“15",
          description: "×›××• ×‘×™×•× ×¨××©×•×Ÿ â€“ ×“×’×© ×¢×œ ×¨××© ×¦×“×“×™ ×•×”×©×œ××ª × ×¤×—."
        }
      ]
    },
    Thursday: {
      title: "×™×•× ×—××™×©×™ â€“ ×’×‘ + ×™×“ ×§×“××™×ª + ×××•×ª",
      subtitle: "×’×‘ ×©× ×™ ×‘×©×‘×•×¢ + ×‘×™×™×¡×¤×¡ ×•×××•×ª ××—×“×©",
      exercises: [
        {
          name: "××ª×— ×‘××—×™×–×” ×¨×—×‘×”",
          muscle: "×’×‘ ×¨×—×‘",
          sets: 4, reps: "6â€“8 / 8â€“10",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ××“×’×™×© ×¨×—×‘ ×”×’×‘."
        },
        {
          name: "×—×ª×™×¨×” ×œ××•×˜ T",
          muscle: "×’×‘ ×××¦×¢×™/×¢×•×‘×™",
          sets: 4, reps: "8â€“10",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ×¢×•×‘×™ ×”×’×‘."
        },
        {
          name: "×—×ª×™×¨×” ×‘×™×©×™×‘×” ×‘×¤×•×œ×™ ×ª×—×ª×•×Ÿ",
          muscle: "×’×‘ ×××¦×¢×™",
          sets: 3, reps: "10â€“12",
          description: "×—×–×¨×” ×¢×œ ×ª×‘× ×™×ª ×™×¦×™×‘×” ×œ×¢×•××¡ × ×•×¡×£."
        },
        {
          name: "×¤×¨×¤×¨ ×”×¤×•×š",
          muscle: "×’×‘ ×¢×œ×™×•×Ÿ + ×›×ª×£ ××—×•×¨×™×ª",
          sets: 3, reps: "12â€“15",
          description: "×“×’×© × ×•×¡×£ ×¢×œ ×™×¦×™×‘×” ×•×›×ª×£ ××—×•×¨×™×ª."
        },
        {
          name: "×¤×©×™×˜×ª ×’×‘ ×‘×›×™×¡× ×¨×•××™",
          muscle: "×’×‘ ×ª×—×ª×•×Ÿ",
          sets: 3, reps: "12â€“15",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ×—×™×–×•×§ ×–×•×§×¤×™ ×’×‘."
        },
        {
          name: "×›×¤×™×¤×•×ª ××¨×¤×§×™× ×‘×¢××™×“×”",
          muscle: "×™×“ ×§×“××™×ª",
          sets: 3, reps: "10â€“12",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ×”××©×š × ×¤×— ×œ×‘×™×™×¡×¤×¡."
        },
        {
          name: "×›×¤×™×¤×•×ª ×¤×˜×™×©×™× ×¢× ×“×××‘×œ×™×",
          muscle: "×™×“ ×§×“××™×ª",
          sets: 3, reps: "12",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ×“×’×© ×¢×œ ×‘×¨×›×™××œ×™×¡ ×•×××•×ª."
        },
        {
          name: "×›×¤×™×¤×ª ×©×•×¨×© ×›×£ ×”×™×“ ×”×¤×•×›×”",
          muscle: "×××•×ª",
          sets: 3, reps: "12â€“15",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ××—×™×–×” ×—×–×§×”."
        }
      ]
    },
    friday: {
      title: "×™×•× ×©×™×©×™ â€“ ×¨×’×œ×™×™× + ×œ×™×‘×”",
      subtitle: "×¨×’×œ×™×™× ×©× ×™ â€“ ×“×’×© × ×•×¡×£ ×¢×œ ×™×©×‘×Ÿ, ××—×•×¨×™ ×”×™×¨×š ×•×ª××•××™×",
      exercises: [
        {
          name: "×”××§×˜ ×¡×§×•×•××˜ ×‘××›×•× ×”",
          muscle: "×§×•×•××“ + ×™×©×‘×Ÿ",
          sets: 4, reps: "8â€“10",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ ×“×’×© × ×•×¡×£."
        },
        {
          name: "×œ×—×™×¦×ª ×¨×’×œ×™×™× ×‘××›×•× ×”",
          muscle: "×›×œ ×”×¨×’×œ",
          sets: 4, reps: "10â€“12",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ × ×¤×— × ×•×¡×£."
        },
        {
          name: "×¤×©×™×˜×ª ×‘×¨×›×™×™× ×‘××›×•× ×”",
          muscle: "×§×•×•××“×¨×™×¡×¤×¡",
          sets: 3, reps: "12â€“15",
          description: "×‘×™×“×•×“ × ×•×¡×£ ×œ×§×•×•××“."
        },
        {
          name: "×›×¤×™×¤×ª ×‘×¨×›×™×™× ×‘×¢××™×“×”/××›×•× ×”",
          muscle: "××—×•×¨×™ ×”×™×¨×š",
          sets: 3, reps: "12â€“15",
          description: "×¢×•×“ × ×¤×— ×œ××¡×˜×¨×™× ×’."
        },
        {
          name: "×“×“×œ×™×¤×˜ ×¨×•×× ×™ (RDL)",
          muscle: "×™×©×‘×Ÿ + ××¡×˜×¨×™× ×’",
          sets: 3, reps: "8â€“10",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ ×ª×¨×’×™×œ ×—×•×‘×”."
        },
        {
          name: "×”×¨××ª ×¢×§×‘×™× ×‘×œ×—×™×¦×ª ×¨×’×œ×™×™×",
          muscle: "×ª××•××™× ×¢×œ×™×•×Ÿ",
          sets: 3, reps: "12â€“20",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ × ×¤×— × ×•×¡×£."
        },
        {
          name: "×”×¨××ª ×¢×§×‘×™× ×‘×™×©×™×‘×” ×‘××›×•× ×”",
          muscle: "×ª××•××™× ×ª×—×ª×•×Ÿ",
          sets: 3, reps: "12â€“20",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ ×”××©×š ×¢×‘×•×“×”."
        },
        {
          name: "×›×¤×™×¤×•×ª ×‘×˜×Ÿ ×‘××›×•× ×”",
          muscle: "×œ×™×‘×”",
          sets: 3, reps: "15",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ ×—×™×–×•×§ ×‘×˜×Ÿ."
        }
      ]
    }
  };

  const dayOrder = [
    { key: "sunday", label: "×¨××©×•×Ÿ" },
    { key: "monday", label: "×©× ×™" },
    { key: "tuesday", label: "×©×œ×™×©×™" },
    { key: "wednesday", label: "×¨×‘×™×¢×™" },
    { key: "Thursday", label: "×—××™×©×™" },
    { key: "friday", label: "×©×™×©×™" }
  ];

  // ===== DOM REFS =====
  const pages = {
    dashboard: document.getElementById("dashboard"),
    workout: document.getElementById("workout"),
    library: document.getElementById("library"),
    history: document.getElementById("history"),
    prs: document.getElementById("prs"),
    ownerPanel: document.getElementById("ownerPanel"),
    trainerPanel: document.getElementById("trainerPanel"),
    settings: document.getElementById("settings")
  };
  const mainPageTitle = document.getElementById("mainPageTitle");
  const mainPageSubtitle = document.getElementById("mainPageSubtitle");

  const navItems = document.querySelectorAll(".nav-item");

  const dayButtonsContainer = document.getElementById("dayButtons");
  const dayTitleEl = document.getElementById("dayTitle");
  const daySubtitleEl = document.getElementById("daySubtitle");
  const exerciseTableBody = document.getElementById("exerciseTableBody");
  const dateInput = document.getElementById("workoutDate");
  const resetDayBtn = document.getElementById("resetDayBtn");
  const goWorkoutModeBtn = document.getElementById("goWorkoutModeBtn");
  const dayHistoryList = document.getElementById("dayHistoryList");
  const exerciseSelect = document.getElementById("exerciseSelect");
  const exportCsvBtn = document.getElementById("exportCsvBtn");
  const historyContainer = document.getElementById("historyContainer");
  const prGrid = document.getElementById("prGrid");
  const ownerUsersTableContainer = document.getElementById("ownerUsersTableContainer");
  const ownerRefreshUsersBtn = document.getElementById("ownerRefreshUsersBtn");
  const ownerCreateUserBtn = document.getElementById("ownerCreateUserBtn");
  const trainerTraineesContainer = document.getElementById("trainerTraineesContainer");

  let currentUserRole = "trainee";
  let currentUserEmail = "";
  let ownerUsersCache = [];

  function applyRoleToUI() {
    const ownerNav = document.querySelector(".nav-owner-only");
    const trainerNav = document.querySelector(".nav-trainer-only");
    const roleBadge = document.getElementById("roleBadge");
    const ownerEmailLabel = document.getElementById("ownerEmailLabel");
    const ownerRoleLabel = document.getElementById("ownerRoleLabel");

    let roleLabel = "××ª×××Ÿ";
    if (currentUserRole === "owner") roleLabel = "×‘×¢×œ×™×";
    else if (currentUserRole === "trainer") roleLabel = "××××Ÿ";

    if (ownerNav) {
      ownerNav.style.display = currentUserRole === "owner" ? "flex" : "none";
    }
    if (trainerNav) {
      trainerNav.style.display = currentUserRole === "trainer" ? "flex" : "none";
    }
    if (roleBadge) {
      roleBadge.textContent = "××—×•×‘×¨ ×›: " + roleLabel + (currentUserEmail ? " (" + currentUserEmail + ")" : "");
    }
    if (ownerEmailLabel) ownerEmailLabel.textContent = currentUserEmail || "-";
    if (ownerRoleLabel) ownerRoleLabel.textContent = roleLabel;
  }

  // workout mode
  const workoutDaySelect = document.getElementById("workoutDaySelect");
  const workoutModeDate = document.getElementById("workoutModeDate");
  const workoutExName = document.getElementById("workoutExName");
  const workoutExMuscle = document.getElementById("workoutExMuscle");
  const workoutSetsRepsTag = document.getElementById("workoutSetsRepsTag");
  const workoutIndexTag = document.getElementById("workoutIndexTag");
  const currentSetLabel = document.getElementById("currentSetLabel");
  const finishSetBtn = document.getElementById("finishSetBtn");
  const nextExerciseBtn = document.getElementById("nextExerciseBtn");
  const workoutWeightInput = document.getElementById("workoutWeightInput");
  const saveWorkoutWeightBtn = document.getElementById("saveWorkoutWeightBtn");
  const restSelect = document.getElementById("restSelect");
  const startRestBtn = document.getElementById("startRestBtn");
  const restTimerDisplay = document.getElementById("restTimerDisplay");
  const workoutExerciseList = document.getElementById("workoutExerciseList");
  // ===== PROGRESS GRAPH RESET =====
  function resetSelectedGraphHistory() {
    try {
      const dayData = program[currentDayKey];
      if (!dayData) return;
      const key = historyKey(currentDayKey, currentChartExerciseIndex);
      localStorage.removeItem(key);
      renderDayHistory(currentDayKey);
      renderHistoryPage();
      renderPRs();
      if (typeof updateChart === "function") {
        updateChart();
      }
    } catch (err) {
      console.error("resetSelectedGraphHistory error", err);
    }
  }

  function resetAllGraphsHistory() {
    if (!confirm("×œ××¤×¡ ××ª ×›×œ ×”×™×¡×˜×•×¨×™×™×ª ×”×’×¨×¤×™× (×›×œ ×”×ª×¨×’×™×œ×™×, ×›×œ ×”×™××™×)?")) return;
    try {
      dayOrder.forEach(d => {
        const dayData = program[d.key];
        if (!dayData || !Array.isArray(dayData.exercises)) return;
        dayData.exercises.forEach((_, idx) => {
          const key = historyKey(d.key, idx);
          localStorage.removeItem(key);
        });
      });
      renderDayHistory(currentDayKey);
      renderHistoryPage();
      renderPRs();
      if (typeof updateChart === "function") {
        updateChart();
      }
    } catch (err) {
      console.error("resetAllGraphsHistory error", err);
    }
  }

  const resetSelectedGraphBtn = document.getElementById("resetSelectedGraphBtn");
  const resetAllGraphsBtn = document.getElementById("resetAllGraphsBtn");
  if (resetSelectedGraphBtn) {
    resetSelectedGraphBtn.addEventListener("click", resetSelectedGraphHistory);
  }
  if (resetAllGraphsBtn) {
    resetAllGraphsBtn.addEventListener("click", resetAllGraphsHistory);
  }


  // settings
  const defaultRestSelect = document.getElementById("defaultRestSelect");
  const resetAllDataBtn = document.getElementById("resetAllDataBtn");

  const exerciseLibraryGrid = document.getElementById("exerciseLibraryGrid");

  let currentDayKey = "sunday";
  let chart;
  let currentChartExerciseIndex = 0;
  let restTimerId = null;
  let restRemaining = 0;
  let workoutCurrentExerciseIndex = 0;
  let workoutCurrentSet = 1;

  // ===== HELPERS: STORAGE KEYS =====
  function storageKey(dayKey, index, field) {
    return `training_${dayKey}_ex${index}_${field}`;
  }

  function dateStorageKey(dayKey) {
    return `training_${dayKey}_date`;
  }

  function historyKey(dayKey, index) {
    return `training_history_${dayKey}_ex${index}`;
  }

  function defaultRestKey() {
    return `training_default_rest`;
  }

  function loadHistory(dayKey, index) {
    try {
      const raw = localStorage.getItem(historyKey(dayKey, index));
      if (!raw) return [];
      const arr = JSON.parse(raw);
      if (!Array.isArray(arr)) return [];
      return arr;
    } catch {
      return [];
    }
  }

  function saveHistory(dayKey, index, history) {
    localStorage.setItem(historyKey(dayKey, index), JSON.stringify(history));
  }

  function addHistoryEntry(dayKey, index, dateStr, weightStr) {
    if (!dateStr || !weightStr) return;
    const weight = parseFloat(weightStr);
    if (isNaN(weight) || weight <= 0) return;
    const history = loadHistory(dayKey, index);
    const last = history[history.length - 1];
    if (last && last.date === dateStr && parseFloat(last.weight) === weight) return;
    const now = new Date();
    history.push({ date: dateStr, weight, ts: now.toISOString() });
    if (history.length > 60) history.shift();
    saveHistory(dayKey, index, history);
  }

  // ===== RENDER DAY (DASHBOARD) =====
  function renderDay(dayKey) {
    currentDayKey = dayKey;
    const dayData = program[dayKey];
    if (!dayData) return;

    dayTitleEl.textContent = dayData.title;
    daySubtitleEl.textContent = dayData.subtitle || "";

    Array.from(dayButtonsContainer.children).forEach(btn => {
      btn.classList.toggle("active", btn.dataset.dayKey === dayKey);
    });

    const savedDate = localStorage.getItem(dateStorageKey(dayKey));
    dateInput.value = savedDate || "";

    exerciseTableBody.innerHTML = "";

    dayData.exercises.forEach((ex, index) => {
      const tr = document.createElement("tr");

      const tdName = document.createElement("td");
      tdName.className = "name-col";
      tdName.textContent = ex.name;
      tr.appendChild(tdName);

      const tdSetsReps = document.createElement("td");
      tdSetsReps.textContent = `${ex.sets} Ã— ${ex.reps}`;
      tr.appendChild(tdSetsReps);

      const tdMuscle = document.createElement("td");
      tdMuscle.className = "muscle-col";
      const badge = document.createElement("span");
      badge.className = "badge-muscle";
      const dot = document.createElement("span");
      dot.className = "dot";
      const text = document.createTextNode(ex.muscle);
      badge.appendChild(dot);
      badge.appendChild(text);
      tdMuscle.appendChild(badge);
      tr.appendChild(tdMuscle);

      const tdSetsDone = document.createElement("td");
      const setsWrapper = document.createElement("div");
      setsWrapper.className = "sets-dots";
      const storedSets = parseInt(localStorage.getItem(storageKey(dayKey, index, "setsDone")) || "0", 10);
      for (let s = 1; s <= ex.sets; s++) {
        const dotEl = document.createElement("button");
        dotEl.type = "button";
        dotEl.className = "set-dot" + (s <= storedSets ? " active" : "");
        dotEl.addEventListener("click", () => {
          const current = parseInt(localStorage.getItem(storageKey(dayKey, index, "setsDone")) || "0", 10);
          let newVal = s;
          if (current === s) {
            newVal = s - 1;
          }
          localStorage.setItem(storageKey(dayKey, index, "setsDone"), newVal.toString());
          renderDay(dayKey);
        });
        setsWrapper.appendChild(dotEl);
      }
      tdSetsDone.appendChild(setsWrapper);
      tr.appendChild(tdSetsDone);

      const tdWeight = document.createElement("td");
      const weightInput = document.createElement("input");
      weightInput.type = "number";
      weightInput.step = "0.5";
      weightInput.placeholder = "××©×§×œ";
      weightInput.value = localStorage.getItem(storageKey(dayKey, index, "weight")) || "";
      weightInput.addEventListener("input", () => {
        localStorage.setItem(storageKey(dayKey, index, "weight"), weightInput.value);
        if (dateInput.value) {
          addHistoryEntry(dayKey, index, dateInput.value, weightInput.value);
          renderDayHistory(dayKey);
          updateChart();
          renderPRs();
          renderHistoryPage();
        }
      });
      tdWeight.appendChild(weightInput);
      tr.appendChild(tdWeight);

      const tdNotes = document.createElement("td");
      const notesInput = document.createElement("input");
      notesInput.type = "text";
      notesInput.placeholder = "×”×¢×¨×” (×¡×˜×™×, ×§×•×©×™, RIR...)";
      notesInput.value = localStorage.getItem(storageKey(dayKey, index, "notes")) || "";
      notesInput.addEventListener("input", () => {
        localStorage.setItem(storageKey(dayKey, index, "notes"), notesInput.value);
      });
      tdNotes.appendChild(notesInput);
      tr.appendChild(tdNotes);

      exerciseTableBody.appendChild(tr);
    });

    populateExerciseSelect();
    renderDayHistory(dayKey);
    updateChart();
    populateWorkoutDaySelect();
    populateWorkoutExerciseList();
    renderPRs();
    renderHistoryPage();
  }

  function renderDayHistory(dayKey) {
    dayHistoryList.innerHTML = "";
    const dayData = program[dayKey];
    if (!dayData) return;
    const items = [];
    dayData.exercises.forEach((ex, index) => {
      const history = loadHistory(dayKey, index);
      history.forEach(h => {
        items.push({
          exName: ex.name,
          date: h.date,
          weight: h.weight,
          ts: h.ts || h.date
        });
      });
    });
    items.sort((a, b) => (a.ts || "").localeCompare(b.ts || ""));
    const lastTen = items.slice(-10);
    lastTen.reverse();
    lastTen.forEach(item => {
      const li = document.createElement("li");
      li.className = "history-item";
      const labelSpan = document.createElement("span");
      labelSpan.className = "label";
      labelSpan.textContent = `${item.exName}`;
      const metaSpan = document.createElement("span");
      metaSpan.className = "meta";
      metaSpan.textContent = `${item.date} â€¢ ${item.weight} ×§×´×’`;
      li.appendChild(labelSpan);
      li.appendChild(metaSpan);
      dayHistoryList.appendChild(li);
    });
    if (lastTen.length === 0) {
      const li = document.createElement("li");
      li.className = "history-item";
      li.innerHTML = `<span class="label">××™×Ÿ ×”×™×¡×˜×•×¨×™×” ×œ×™×•× ×”×–×” ×¢×“×™×™×Ÿ</span><span class="meta">×ª×ª×—×™×œ ×œ×”×–×™×Ÿ ××©×§×œ×™×</span>`;
      dayHistoryList.appendChild(li);
    }
  }

  function populateExerciseSelect() {
    const dayData = program[currentDayKey];
    exerciseSelect.innerHTML = "";
    dayData.exercises.forEach((ex, index) => {
      const opt = document.createElement("option");
      opt.value = index;
      opt.textContent = ex.name;
      exerciseSelect.appendChild(opt);
    });
    currentChartExerciseIndex = 0;
    exerciseSelect.value = "0";
  }

  function updateChart() {
    const dayData = program[currentDayKey];
    if (!dayData) return;
    const ex = dayData.exercises[currentChartExerciseIndex];
    const history = loadHistory(currentDayKey, currentChartExerciseIndex);

    const labels = history.map((h, i) => h.date || `××™××•×Ÿ ${i + 1}`);
    const values = history.map(h => h.weight);

    const ctx = document.getElementById("progressChart").getContext("2d");

    if (chart) {
      chart.destroy();
    }

    chart = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: ex.name,
          data: values,
          tension: 0.3,
          fill: true,
          borderColor: "#f97316",
          backgroundColor: "rgba(249,115,22,0.22)",
          pointRadius: 3,
          pointBackgroundColor: "#fed7aa"
        }]
      },
      options: {
        plugins: {
          legend: {
            labels: {
              font: { size: 11 },
              color: "#e5e7eb"
            }
          }
        },
        scales: {
          x: {
            ticks: { color: "#9ca3af", font: { size: 10 } },
            grid: { color: "rgba(55,65,81,0.4)" }
          },
          y: {
            ticks: { color: "#9ca3af", font: { size: 10 } },
            grid: { color: "rgba(55,65,81,0.4)" }
          }
        }
      }
    });
  }
  // ===== OWNER PANEL LOGIC =====
  async function ownerLoadUsers() {
    try {
      if (currentUserRole !== "owner") {
        if (ownerUsersTableContainer) {
          ownerUsersTableContainer.innerHTML = "<p class='small-note'>×¨×§ ×‘×¢×œ×™× ×™×›×•×œ ×œ×¨××•×ª ××ª ×¨×©×™××ª ×”××©×ª××©×™×.</p>";
        }
        return;
      }
      if (!window.db) {
        if (ownerUsersTableContainer) {
          ownerUsersTableContainer.innerHTML = "<p class='small-note'>×”×—×™×‘×•×¨ ×œ×¢× ×Ÿ (Firestore) ×œ× ×–××™×Ÿ ×›×¨×’×¢.</p>";
        }
        return;
      }
      const snap = await db.collection("users").orderBy("createdAt", "asc").get();
      ownerUsersCache = [];
      snap.forEach(doc => {
        const d = doc.data() || {};
        ownerUsersCache.push({
          uid: doc.id,
          email: d.email || "",
          role: d.role || "trainee",
          trainees: Array.isArray(d.trainees) ? d.trainees : [],
          trainerUid: d.trainerUid || null,
          createdAt: d.createdAt && d.createdAt.toDate ? d.createdAt.toDate().toISOString().slice(0, 10) : ""
        });
      });
      renderOwnerUsersTable();
    } catch (err) {
      console.error("ownerLoadUsers error", err);
      if (ownerUsersTableContainer) {
        ownerUsersTableContainer.innerHTML = "<p class='small-note'>×©×’×™××” ×‘×˜×¢×™× ×ª ×”××©×ª××©×™×.</p>";
      }
    }
  }

  function renderOwnerUsersTable() {
    if (!ownerUsersTableContainer) return;
    if (!ownerUsersCache.length) {
      ownerUsersTableContainer.innerHTML = "<p class='small-note'>×œ× × ××¦××• ××©×ª××©×™×.</p>";
      return;
    }
    let htmlTable = "<table class='simple-table'><thead><tr>"
      + "<th>××™××™×™×œ</th>"
      + "<th>×ª×¤×§×™×“</th>"
      + "<th>××¡' ××ª××× ×™×</th>"
      + "<th>×ª××¨×™×š ×”×¦×˜×¨×¤×•×ª</th>"
      + "<th>×¤×¢×•×œ×•×ª</th>"
      + "</tr></thead><tbody>";

    ownerUsersCache.forEach(u => {
      const traineesCount = (u.trainees && u.trainees.length) || 0;
      htmlTable += "<tr>"
        + "<td>" + (u.email || "-") + "</td>"
        + "<td>"
        + "<select class='owner-role-select' data-uid='" + u.uid + "'>"
        + "<option value='trainee'" + (u.role === "trainee" ? " selected" : "") + ">××ª×××Ÿ</option>"
        + "<option value='trainer'" + (u.role === "trainer" ? " selected" : "") + ">××××Ÿ</option>"
        + "<option value='owner'" + (u.role === "owner" ? " selected" : "") + ">×‘×¢×œ×™×</option>"
        + "</select>"
        + "</td>"
        + "<td>" + traineesCount + "</td>"
        + "<td>" + (u.createdAt || "-") + "</td>"
        + "<td>"
        + "<button class='btn ghost owner-trainees-btn' data-uid='" + u.uid + "' data-email='" + (u.email || "") + "'>× ×™×”×•×œ ××ª××× ×™×</button>"
        + "<button class='btn ghost owner-reset-btn' data-uid='" + u.uid + "' data-email='" + (u.email || "") + "'>××™×¤×•×¡ × ×ª×•× ×™×</button>"
        + "<button class='btn danger owner-delete-btn' data-uid='" + u.uid + "' data-email='" + (u.email || "") + "'>××—×™×§×”</button>"
        + "</td>"
        + "</tr>";
    });

    htmlTable += "</tbody></table>";
    ownerUsersTableContainer.innerHTML = htmlTable;

    document.querySelectorAll(".owner-role-select").forEach(sel => {
      sel.addEventListener("change", async (e) => {
        const uid = e.target.getAttribute("data-uid");
        const newRole = e.target.value;
        await ownerUpdateUserRole(uid, newRole);
      });
    });
    document.querySelectorAll(".owner-reset-btn").forEach(btn => {
      btn.addEventListener("click", async (e) => {
        const uid = e.target.getAttribute("data-uid");
        const email = e.target.getAttribute("data-email") || "";
        await ownerResetUserData(uid, email);
      });
    });
    document.querySelectorAll(".owner-delete-btn").forEach(btn => {
      btn.addEventListener("click", async (e) => {
        const uid = e.target.getAttribute("data-uid");
        const email = e.target.getAttribute("data-email") || "";
        await ownerDeleteUser(uid, email);
      });
    });
    document.querySelectorAll(".owner-trainees-btn").forEach(btn => {
      btn.addEventListener("click", async (e) => {
        const uid = e.target.getAttribute("data-uid");
        const email = e.target.getAttribute("data-email") || "";
        await ownerManageTrainees(uid, email);
      });
    });
  }

  async function ownerLogAction(action, targetUid, details) {
    try {
      if (!window.db) return;
      await db.collection("logs_adminActions").add({
        actorUid: window.currentUid || null,
        action: action,
        targetUid: targetUid || null,
        details: details || null,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
    } catch (err) {
      console.error("ownerLogAction error", err);
    }
  }

  async function ownerUpdateUserRole(uid, newRole) {
    if (!window.db) return;
    try {
      await db.collection("users").doc(uid).set(
        {
          role: newRole,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        },
        { merge: true }
      );
      await ownerLogAction("change_role", uid, { role: newRole });
      const found = ownerUsersCache.find(u => u.uid === uid);
      if (found) found.role = newRole;
      if (window.currentUid === uid) {
        currentUserRole = newRole;
        applyRoleToUI();
      }
      renderOwnerUsersTable();
    } catch (err) {
      console.error("ownerUpdateUserRole error", err);
      alert("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×ª×¤×§×™×“.");
    }
  }

  async function ownerResetUserData(uid, email) {
    if (!window.db) return;
    if (!confirm("×œ××¤×¡ ××ª ×›×œ ×”× ×ª×•× ×™× ×©×œ ×”××©×ª××© " + (email || uid) + "?")) return;
    try {
      await db.collection("training_states").doc(uid).set(
        {
          storage: {},
          resetAt: firebase.firestore.FieldValue.serverTimestamp(),
          resetBy: window.currentUid || null
        },
        { merge: true }
      );
      await ownerLogAction("reset_user", uid, { email });
      alert("×”× ×ª×•× ×™× ××•×¤×¡×• ×œ××©×ª××©.");
    } catch (err) {
      console.error("ownerResetUserData error", err);
      alert("×©×’×™××” ×‘××™×¤×•×¡ ×”× ×ª×•× ×™×.");
    }
  }

  async function ownerDeleteUser(uid, email) {
    if (!window.db) return;
    if (!confirm("×œ××—×•×§ ××ª ×”××©×ª××© " + (email || uid) + " ××”××¢×¨×›×ª (×¢× ×Ÿ ×‘×œ×‘×“)?")) return;
    try {
      await db.collection("training_states").doc(uid).delete().catch(() => {});
      await db.collection("users").doc(uid).delete().catch(() => {});
      await ownerLogAction("delete_user", uid, { email });
      ownerUsersCache = ownerUsersCache.filter(u => u.uid !== uid);
      renderOwnerUsersTable();
      alert("×”××©×ª××© × ××—×§ ××”×¢× ×Ÿ.");
    } catch (err) {
      console.error("ownerDeleteUser error", err);
      alert("×©×’×™××” ×‘××—×™×§×ª ×”××©×ª××©.");
    }
  }

  async function ownerManageTrainees(uid, email) {
    if (!window.db) return;
    const input = prompt("×”×›× ×¡ ××™××™×™×œ×™× ×©×œ ××ª××× ×™× (××•×¤×¨×“×™× ×‘×¤×¡×™×§×™×) ×¢×‘×•×¨ ×”××××Ÿ " + (email || uid));
    if (!input) return;
    const emails = input.split(",").map(e => e.trim().toLowerCase()).filter(Boolean);
    if (!emails.length) return;

    try {
      const trainees = ownerUsersCache.filter(u => u.email && emails.includes(u.email.toLowerCase()));
      const traineeUids = trainees.map(t => t.uid);
      await db.collection("users").doc(uid).set(
        {
          trainees: traineeUids,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        },
        { merge: true }
      );
      const batch = db.batch();
      trainees.forEach(t => {
        const ref = db.collection("users").doc(t.uid);
        batch.set(ref, { trainerUid: uid }, { merge: true });
      });
      await batch.commit();
      await ownerLogAction("assign_trainees", uid, { traineeUids, emails });
      const found = ownerUsersCache.find(u => u.uid === uid);
      if (found) found.trainees = traineeUids;
      renderOwnerUsersTable();
      alert("×”××ª××× ×™× ×©×•×™×›×• ×œ××××Ÿ.");
    } catch (err) {
      console.error("ownerManageTrainees error", err);
      alert("×©×’×™××” ×‘×©×™×•×š ×”××ª××× ×™×.");
    }
  }

  async function ownerCreateUserFlow() {
    if (!window.db || !window.firebase) {
      alert("×¤×•× ×§×¦×™×™×ª ×™×¦×™×¨×ª ××©×ª××© ×“×•×¨×©×ª Firebase ×¤×¢×™×œ.");
      return;
    }
    const email = prompt("××™××™×™×œ ×œ××©×ª××© ×”×—×“×©:");
    if (!email) return;
    const role = prompt("×ª×¤×§×™×“ ×œ××©×ª××© (owner/trainer/trainee):", "trainee") || "trainee";

    try {
      await db.collection("users").add({
        email,
        role,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      await ownerLogAction("create_user", null, { email, role });
      alert("×”××©×ª××© × ×•×¡×£ ×œ×¨×©×™××ª users. ×•×“× ×©×§×™×™× ×’× ×‘-Auth.");
      ownerLoadUsers();
    } catch (err) {
      console.error("ownerCreateUserFlow error", err);
      alert("×©×’×™××” ×‘×™×¦×™×¨×ª ×”××©×ª××©.");
    }
  }

  if (ownerRefreshUsersBtn) {
    ownerRefreshUsersBtn.addEventListener("click", ownerLoadUsers);
  }
  if (ownerCreateUserBtn) {
    ownerCreateUserBtn.addEventListener("click", ownerCreateUserFlow);
  }



  // ===== TRAINER PANEL LOGIC =====
  async function loadTrainerTrainees() {
    const container = document.getElementById("trainerTraineesContainer");
    if (!container) return;

    if (currentUserRole !== "trainer") {
      container.innerHTML = "<p class='small-note'>×¨×§ ××××Ÿ ×™×›×•×œ ×œ×¨××•×ª ×›××Ÿ ××ª ×¨×©×™××ª ×”××ª××× ×™× ×©×œ×•.</p>";
      return;
    }
    if (!window.db || !window.currentUid) {
      container.innerHTML = "<p class='small-note'>×”×—×™×‘×•×¨ ×œ×¢× ×Ÿ ×œ× ×–××™×Ÿ ×›×¨×’×¢.</p>";
      return;
    }

    try {
      container.innerHTML = "<p class='small-note'>×˜×•×¢×Ÿ ××ª××× ×™×...</p>";
      const snap = await db.collection("users").where("trainerUid", "==", window.currentUid).get();
      if (snap.empty) {
        container.innerHTML = "<p class='small-note'>×œ× × ××¦××• ××ª××× ×™× ×”××©×•×™×›×™× ××œ×™×š ×›×¨×’×¢.</p>";
        return;
      }

      const trainees = [];
      snap.forEach(doc => {
        const d = doc.data() || {};
        trainees.push({
          uid: doc.id,
          email: d.email || "",
          role: d.role || "trainee"
        });
      });

      let html = "<table class='simple-table'><thead><tr>"
        + "<th>××™××™×™×œ</th>"
        + "<th>×ª×¤×§×™×“</th>"
        + "<th>×¤×¢×•×œ×•×ª</th>"
        + "</tr></thead><tbody>";

      trainees.forEach(t => {
        const roleLabel = t.role === "trainer" ? "××××Ÿ" : (t.role === "owner" ? "×‘×¢×œ×™×" : "××ª×××Ÿ");
        html += "<tr>"
          + "<td>" + (t.email || "-") + "</td>"
          + "<td>" + roleLabel + "</td>"
          + "<td>"
          + "<button class='btn btn-ghost trainer-view-btn' data-uid='" + t.uid + "' data-email='" + (t.email || "") + "'>×¦×¤×” ×‘× ×ª×•× ×™×</button>"
          + "</td>"
          + "</tr>";
      });

      html += "</tbody></table>";
      container.innerHTML = html;

      document.querySelectorAll(".trainer-view-btn").forEach(btn => {
        btn.addEventListener("click", async (e) => {
          const uid = e.currentTarget.getAttribute("data-uid");
          const email = e.currentTarget.getAttribute("data-email") || "";
          await trainerViewTraineeData(uid, email);
        });
      });
    } catch (err) {
      console.error("loadTrainerTrainees error", err);
      container.innerHTML = "<p class='small-note'>×©×’×™××” ×‘×˜×¢×™× ×ª ×¨×©×™××ª ×”××ª××× ×™×.</p>";
    }
  }

  async function trainerViewTraineeData(uid, email) {
    const detailsContainer = document.getElementById("trainerTraineeDetailsContainer");
    const pre = document.getElementById("trainerTraineeDetailsPre");
    const closeBtn = document.getElementById("trainerCloseDetailsBtn");
    if (!detailsContainer || !pre) return;

    if (!window.db) {
      alert("×”×—×™×‘×•×¨ ×œ×¢× ×Ÿ ×œ× ×–××™×Ÿ ×›×¨×’×¢.");
      return;
    }

    try {
      const ref = db.collection("training_states").doc(uid);
      const snap = await ref.get();
      if (!snap.exists) {
        pre.textContent = "×œ× × ××¦××• × ×ª×•× ×™× ×œ××©×ª××© ×–×”.";
      } else {
        const data = snap.data() || {};
        pre.textContent = JSON.stringify(data.storage || data, null, 2);
      }
      detailsContainer.style.display = "block";
      if (closeBtn) {
        closeBtn.onclick = () => {
          detailsContainer.style.display = "none";
        };
      }
    } catch (err) {
      console.error("trainerViewTraineeData error", err);
      alert("×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™× ×©×œ ×”××ª×××Ÿ.");
    }
  }

  // ===== WORKOUT MODE =====
  function populateWorkoutDaySelect() {
    workoutDaySelect.innerHTML = "";
    dayOrder.forEach(d => {
      const opt = document.createElement("option");
      opt.value = d.key;
      opt.textContent = d.label;
      workoutDaySelect.appendChild(opt);
    });
    workoutDaySelect.value = currentDayKey;
  }

  function populateWorkoutExerciseList() {
    const dayKey = workoutDaySelect.value || currentDayKey;
    const dayData = program[dayKey];
    workoutExerciseList.innerHTML = "";
    if (!dayData) return;
    dayData.exercises.forEach((ex, index) => {
      const li = document.createElement("li");
      li.className = "workout-list-item" + (index === workoutCurrentExerciseIndex ? " active" : "");
      const left = document.createElement("span");
      left.textContent = ex.name;
      const right = document.createElement("span");
      right.textContent = `${ex.sets} Ã— ${ex.reps}`;
      li.appendChild(left);
      li.appendChild(right);
      li.addEventListener("click", () => {
        workoutCurrentExerciseIndex = index;
        workoutCurrentSet = 1;
        renderWorkoutCurrent();
      });
      workoutExerciseList.appendChild(li);
    });
  }

  function renderWorkoutCurrent() {
    const dayKey = workoutDaySelect.value || currentDayKey;
    const dayData = program[dayKey];
    if (!dayData) return;
    const ex = dayData.exercises[workoutCurrentExerciseIndex];
    if (!ex) return;

    workoutExName.textContent = ex.name;
    workoutExMuscle.textContent = ex.muscle;
    workoutSetsRepsTag.textContent = `${ex.sets} Ã— ${ex.reps}`;
    workoutIndexTag.textContent = `×ª×¨×’×™×œ ${workoutCurrentExerciseIndex + 1} ××ª×•×š ${dayData.exercises.length}`;
    currentSetLabel.textContent = workoutCurrentSet.toString();

    const storedWeight = localStorage.getItem(storageKey(dayKey, workoutCurrentExerciseIndex, "weight"));
    workoutWeightInput.value = storedWeight || "";

    Array.from(workoutExerciseList.children).forEach((li, idx) => {
      li.classList.toggle("active", idx === workoutCurrentExerciseIndex);
    });

    const savedDate = localStorage.getItem(dateStorageKey(dayKey));
    if (savedDate) {
      workoutModeDate.value = savedDate;
    }
  }

  function startRestTimer(seconds) {
    if (restTimerId) {
      clearInterval(restTimerId);
      restTimerId = null;
    }
    restRemaining = seconds;
    updateRestDisplay();
    restTimerId = setInterval(() => {
      restRemaining--;
      if (restRemaining <= 0) {
        clearInterval(restTimerId);
        restTimerId = null;
        restRemaining = 0;
      }
      updateRestDisplay();
    }, 1000);
  }

  function updateRestDisplay() {
    const m = Math.floor(restRemaining / 60);
    const s = restRemaining % 60;
    const mm = m.toString().padStart(2, "0");
    const ss = s.toString().padStart(2, "0");
    restTimerDisplay.textContent = `${mm}:${ss}`;
  }

  // ===== EXERCISE LIBRARY =====
  function renderExerciseLibrary() {
    exerciseLibraryGrid.innerHTML = "";
    dayOrder.forEach(d => {
      const dayData = program[d.key];
      if (!dayData) return;
      dayData.exercises.forEach(ex => {
        const card = document.createElement("div");
        card.className = "exercise-card";
        const h4 = document.createElement("h4");
        h4.textContent = ex.name;
        const muscle = document.createElement("div");
        muscle.className = "muscle";
        muscle.textContent = ex.muscle;
        const p = document.createElement("p");
        p.textContent = ex.description || "";
        card.appendChild(h4);
        card.appendChild(muscle);
        card.appendChild(p);
        exerciseLibraryGrid.appendChild(card);
      });
    });
  }

  // ===== HISTORY PAGE =====
  function renderHistoryPage() {
    historyContainer.innerHTML = "";
    const allEntries = [];
    dayOrder.forEach(d => {
      const dayKey = d.key;
      const dayData = program[dayKey];
      if (!dayData) return;
      dayData.exercises.forEach((ex, index) => {
        const history = loadHistory(dayKey, index);
        history.forEach(h => {
          allEntries.push({
            dayKey,
            dayLabel: d.label,
            exName: ex.name,
            date: h.date,
            weight: h.weight,
            ts: h.ts || (h.date + "T00:00:00")
          });
        });
      });
    });
    if (allEntries.length === 0) {
      const p = document.createElement("p");
      p.className = "small-note";
      p.textContent = "××™×Ÿ ×¢×“×™×™×Ÿ ×”×™×¡×˜×•×¨×™×™×ª ××™××•× ×™×. ××œ× ××©×§×œ×™× ×‘×“×©×‘×•×¨×“ ×•×ª×ª×—×™×œ ×œ×‘× ×•×ª ×™×•××Ÿ.";
      historyContainer.appendChild(p);
      return;
    }

    allEntries.sort((a, b) => (a.ts || "").localeCompare(b.ts || ""));
    const groups = {};
    allEntries.forEach(e => {
      const key = `${e.date}__${e.dayLabel}`;
      if (!groups[key]) groups[key] = [];
      groups[key].push(e);
    });

    Object.keys(groups).forEach(groupKey => {
      const [date, dayLabel] = groupKey.split("__");
      const div = document.createElement("div");
      div.className = "history-group";
      const title = document.createElement("div");
      title.className = "history-group-title";
      title.textContent = `${date} â€“ ×™×•× ${dayLabel}`;
      div.appendChild(title);
      const ul = document.createElement("ul");
      ul.className = "history-group-list";
      groups[groupKey].forEach(e => {
        const li = document.createElement("li");
        li.innerHTML = `<span>${e.exName}</span><span>${e.weight} ×§×´×’</span>`;
        ul.appendChild(li);
      });
      div.appendChild(ul);
      historyContainer.appendChild(div);
    });
  }

  // ===== PR PAGE =====
  function renderPRs() {
    prGrid.innerHTML = "";
    dayOrder.forEach(d => {
      const dayKey = d.key;
      const dayData = program[dayKey];
      if (!dayData) return;
      dayData.exercises.forEach((ex, index) => {
        const history = loadHistory(dayKey, index);
        if (!history.length) return;
        let maxEntry = history[0];
        history.forEach(h => {
          if (parseFloat(h.weight) > parseFloat(maxEntry.weight)) {
            maxEntry = h;
          }
        });
        const card = document.createElement("div");
        card.className = "pr-card";
        const h4 = document.createElement("h4");
        h4.textContent = ex.name;
        const val = document.createElement("div");
        val.className = "pr-value";
        val.textContent = `${maxEntry.weight} ×§×´×’`;
        const meta = document.createElement("div");
        meta.className = "pr-meta";
        meta.textContent = `×©×™× ×‘×™×•× ${maxEntry.date} â€¢ ×™×•× ${d.label}`;
        card.appendChild(h4);
        card.appendChild(val);
        card.appendChild(meta);
        prGrid.appendChild(card);
      });
    });
    if (!prGrid.children.length) {
      const p = document.createElement("p");
      p.className = "small-note";
      p.textContent = "××™×Ÿ ×¢×“×™×™×Ÿ ×©×™××™×, ×¦×¨×™×š ×œ×”×–×™×Ÿ ××¡×¤×¨ ××™××•× ×™× ×¢× ××©×§×œ×™× ×›×“×™ ×œ×—×©×‘ PR.";
      prGrid.appendChild(p);
    }
  }

  // ===== EXPORT CSV =====
  function exportHistoryToCsv() {
    const rows = [["day_key", "day_label", "date", "exercise", "weight", "timestamp"]];
    dayOrder.forEach(d => {
      const dayKey = d.key;
      const dayData = program[dayKey];
      if (!dayData) return;
      dayData.exercises.forEach((ex, index) => {
        const history = loadHistory(dayKey, index);
        history.forEach(h => {
          rows.push([
            dayKey,
            d.label,
            h.date,
            ex.name,
            h.weight,
            h.ts || ""
          ]);
        });
      });
    });
    if (rows.length === 1) {
      alert("××™×Ÿ × ×ª×•× ×™ ×”×™×¡×˜×•×¨×™×” ×œ×™×™×¦×.");
      return;
    }
    let csv = "";
    rows.forEach(r => {
      csv += r.map(v => `"${String(v).replace(/"/g, '""')}"`).join(",") + "\n";
    });
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "training-history.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // ===== SETTINGS =====
  function loadDefaultRest() {
    const val = localStorage.getItem(defaultRestKey());
    const useVal = val || "90";
    defaultRestSelect.value = useVal;
    restSelect.value = useVal;
  }

  function saveDefaultRest() {
    const val = defaultRestSelect.value || "90";
    localStorage.setItem(defaultRestKey(), val);
    restSelect.value = val;
  }

  function resetAllData() {
    if (!confirm("×œ××—×•×§ ××ª ×›×œ ×”× ×ª×•× ×™× (××©×§×œ×™×, ×”×¢×¨×•×ª, ×”×™×¡×˜×•×¨×™×”, ×©×™××™×) ××”××›×©×™×¨ ×”×–×”?")) return;
    Object.keys(localStorage)
      .filter(k => k.startsWith("training_"))
      .forEach(k => localStorage.removeItem(k));
    renderDay(currentDayKey);
    renderHistoryPage();
    renderPRs();
    alert("×›×œ ×”× ×ª×•× ×™× × ××—×§×• ××”××›×©×™×¨ ×”×–×”. ××¤×©×¨ ×œ×”×ª×—×™×œ ×××¤×¡.");
  }

  // ===== NAVIGATION =====
  function setActivePage(pageKey) {
    Object.keys(pages).forEach(key => {
      pages[key].classList.toggle("active", key === pageKey);
    });
    navItems.forEach(item => {
      item.classList.toggle("active", item.dataset.page === pageKey);
    });
    switch (pageKey) {
      case "dashboard":
        mainPageTitle.textContent = "×“×©×‘×•×¨×“ ××™××•× ×™× ×©×‘×•×¢×™";
        mainPageSubtitle.textContent = "××¢×§×‘ ××©×§×œ×™×, ×¡×˜×™× ×•×”×ª×§×“××•×ª ×œ××•×¨×š ×–××Ÿ.";
        break;
      case "workout":
        mainPageTitle.textContent = "××¦×‘ ××™××•×Ÿ â€“ ×‘×™×¦×•×¢ ×¡×˜×™× ×‘×–××Ÿ ×××ª";
        mainPageSubtitle.textContent = "×”×ª××§×“×•×ª ×‘×ª×¨×’×™×œ ××—×“, ×¡×˜×™×, ×˜×™×™××¨ ×× ×•×—×” ×•××¢×‘×¨ ××•×˜×•××˜×™.";
        break;
      case "library":
        mainPageTitle.textContent = "×¡×¤×¨×™×™×ª ×ª×¨×’×™×œ×™× ××œ××”";
        mainPageSubtitle.textContent = "×”×‘× ×” ××” ×¢×•×©×” ×›×œ ×ª×¨×’×™×œ ×•××™×š ×œ×‘×¦×¢ × ×›×•×Ÿ.";
        renderExerciseLibrary();
        break;
      case "history":
        mainPageTitle.textContent = "×™×•××Ÿ ××™××•× ×™×";
        mainPageSubtitle.textContent = "×›×œ ×”××™××•× ×™×, ×›×œ ×”×ª××¨×™×›×™×, ×”×›×œ ×‘××§×•× ××—×“.";
        renderHistoryPage();
        break;
      case "prs":
        mainPageTitle.textContent = "×©×™××™× ××™×©×™×™× (PRs)";
        mainPageSubtitle.textContent = "××©×§×œ×™× ×”×›×™ ×—×–×§×™× ×©×”×¨××ª ×‘×›×œ ×ª×¨×’×™×œ.";
        renderPRs();
        break;
      case "ownerPanel":
        mainPageTitle.textContent = "×¤×× ×œ ×‘×¢×œ×™×";
        mainPageSubtitle.textContent = "× ×™×”×•×œ ××©×ª××©×™×, ×ª×¤×§×™×“×™× ×•× ×ª×•× ×™× ××”×¢× ×Ÿ.";
        break;
      case "trainerPanel":
        mainPageTitle.textContent = "×¤×× ×œ ××××Ÿ";
        mainPageSubtitle.textContent = "×¦×¤×™×™×” ×‘××ª××× ×™× ×”××©×•×™×›×™× ××œ×™×š.";
        if (typeof loadTrainerTrainees === "function") {
          loadTrainerTrainees();
        }
        break;
      case "settings":
        mainPageTitle.textContent = "×”×’×“×¨×•×ª ××¤×œ×™×§×¦×™×”";
        mainPageSubtitle.textContent = "×©×œ×™×˜×” ×¢×œ ×× ×•×—×”, ××™×¤×•×¡×™× ×•×”×¢×“×¤×•×ª.";
        break;
    }
  }

  // ===== INIT =====
  // nav
  navItems.forEach(item => {
    item.addEventListener("click", () => {
      const pageKey = item.dataset.page;
      setActivePage(pageKey);
    });
  });

  // day buttons
  dayOrder.forEach(d => {
    const btn = document.createElement("button");
    btn.className = "day-button" + (d.key === currentDayKey ? " active" : "");
    btn.dataset.dayKey = d.key;
    const dot = document.createElement("span");
    dot.className = "dot";
    btn.appendChild(dot);
    btn.appendChild(document.createTextNode("×™×•× " + d.label));
    btn.addEventListener("click", () => {
      renderDay(d.key);
    });
    dayButtonsContainer.appendChild(btn);
  });

  dateInput.addEventListener("change", () => {
    localStorage.setItem(dateStorageKey(currentDayKey), dateInput.value);
  });

  resetDayBtn.addEventListener("click", () => {
    if (!confirm("×œ××¤×¡ ××ª ×›×œ ×”××©×§×œ×™×, ×”×”×¢×¨×•×ª, ×”×¡×˜×™× ×•×”×”×™×¡×˜×•×¨×™×” ×œ×™×•× ×”×–×”?")) return;
    const dayData = program[currentDayKey];
    dayData.exercises.forEach((_, index) => {
      localStorage.removeItem(storageKey(currentDayKey, index, "weight"));
      localStorage.removeItem(storageKey(currentDayKey, index, "notes"));
      localStorage.removeItem(storageKey(currentDayKey, index, "setsDone"));
      localStorage.removeItem(historyKey(currentDayKey, index));
    });
    localStorage.removeItem(dateStorageKey(currentDayKey));
    renderDay(currentDayKey);
  });

  goWorkoutModeBtn.addEventListener("click", () => {
    setActivePage("workout");
  });

  exerciseSelect.addEventListener("change", () => {
    currentChartExerciseIndex = parseInt(exerciseSelect.value, 10) || 0;
    updateChart();
  });

  exportCsvBtn.addEventListener("click", exportHistoryToCsv);

  // workout mode events
  workoutDaySelect.addEventListener("change", () => {
    workoutCurrentExerciseIndex = 0;
    workoutCurrentSet = 1;
    populateWorkoutExerciseList();
    renderWorkoutCurrent();
  });

  workoutModeDate.addEventListener("change", () => {
    const dayKey = workoutDaySelect.value || currentDayKey;
    localStorage.setItem(dateStorageKey(dayKey), workoutModeDate.value);
    if (dayKey === currentDayKey) {
      dateInput.value = workoutModeDate.value;
    }
  });

  finishSetBtn.addEventListener("click", () => {
    const dayKey = workoutDaySelect.value || currentDayKey;
    const dayData = program[dayKey];
    const ex = dayData.exercises[workoutCurrentExerciseIndex];
    const currentStored = parseInt(localStorage.getItem(storageKey(dayKey, workoutCurrentExerciseIndex, "setsDone")) || "0", 10);
    const newVal = Math.min(currentStored + 1, ex.sets);
    localStorage.setItem(storageKey(dayKey, workoutCurrentExerciseIndex, "setsDone"), newVal.toString());
    workoutCurrentSet = Math.min(newVal + 1, ex.sets);
    currentSetLabel.textContent = workoutCurrentSet.toString();
    if (dayKey === currentDayKey) {
      renderDay(dayKey);
    }
  });

  nextExerciseBtn.addEventListener("click", () => {
    const dayKey = workoutDaySelect.value || currentDayKey;
    const dayData = program[dayKey];
    workoutCurrentExerciseIndex = (workoutCurrentExerciseIndex + 1) % dayData.exercises.length;
    workoutCurrentSet = 1;
    renderWorkoutCurrent();
  });

  saveWorkoutWeightBtn.addEventListener("click", () => {
    const dayKey = workoutDaySelect.value || currentDayKey;
    const dayData = program[dayKey];
    const ex = dayData.exercises[workoutCurrentExerciseIndex];
    const weight = workoutWeightInput.value;
    localStorage.setItem(storageKey(dayKey, workoutCurrentExerciseIndex, "weight"), weight);
    const dateStr = workoutModeDate.value || dateInput.value;
    if (dateStr) {
      addHistoryEntry(dayKey, workoutCurrentExerciseIndex, dateStr, weight);
      renderDayHistory(dayKey);
      updateChart();
      renderPRs();
      renderHistoryPage();
    }
    if (dayKey === currentDayKey) {
      renderDay(dayKey);
    }
    alert(`× ×©××¨ ××©×§×œ ${weight} ×§×´×’ ×œ-${ex.name}`);
  });

  startRestBtn.addEventListener("click", () => {
    const seconds = parseInt(restSelect.value || "90", 10);
    startRestTimer(seconds);
  });

  // settings
  loadDefaultRest();
  defaultRestSelect.addEventListener("change", saveDefaultRest);
  resetAllDataBtn.addEventListener("click", resetAllData);

  // initial render
  renderDay(currentDayKey);
  populateWorkoutDaySelect();
  populateWorkoutExerciseList();
  renderWorkoutCurrent();
  renderExerciseLibrary();
  renderHistoryPage();
  renderPRs();
</script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let loginRequested = false;
      try { auth.signOut(); } catch (e) {}

      const OWNER_EMAIL = "Ariel0202nagar@gmail.com";

      const authScreenEl   = document.getElementById("auth-screen");
      const emailInput     = document.getElementById("loginEmail");
      const passInput      = document.getElementById("loginPass");
      const errorEl        = document.getElementById("authError");
      const titleEl        = document.getElementById("authTitle");
      const subtitleEl     = document.getElementById("authSubtitle");
      const btnEl          = document.getElementById("loginBtn");
      const switchTextEl   = document.getElementById("authSwitchText");
      const switchLinkEl   = document.getElementById("authSwitchLink");
      const forgotPassLink = document.getElementById("forgotPassLink");

      let mode        = "login"; // "login" / "register"
      let currentUid  = null;
      let isSyncing   = false;
      let pendingSync = false;

      function setMode(nextMode) {
        mode = nextMode;
        errorEl.style.display = "none";

        if (mode === "login") {
          titleEl.textContent    = "×”×ª×—×‘×¨×•×ª ×œ××¢×¨×›×ª";
          subtitleEl.textContent = "×”×–×Ÿ ××™××™×™×œ ×•×¡×™×¡××” ×›×“×™ ×œ×”×™×›× ×¡ ×œ××¢×¨×›×ª ×”××™××•× ×™× ×”××™×©×™×ª ×©×œ×š ×‘×¢× ×Ÿ.";
          btnEl.textContent      = "×”××©×š ×œ××¢×¨×›×ª";
          switchTextEl.textContent = "××™×Ÿ ×œ×š ××©×ª××© ×¢×“×™×™×Ÿ?";
          switchLinkEl.textContent = "×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ×—×“×©";
        } else {
          titleEl.textContent    = "×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ×—×“×©";
          subtitleEl.textContent = "×¦×•×¨ ××©×ª××© ×—×“×© ×œ××¢×¨×›×ª. ×”××™××•× ×™× ×©×œ×š ×™×™×©××¨×• ×œ×—×©×‘×•×Ÿ ×”×–×” ×‘×¢× ×Ÿ.";
          btnEl.textContent      = "×™×¦×™×¨×ª ×—×©×‘×•×Ÿ";
          switchTextEl.textContent = "×›×‘×¨ ×™×© ×œ×š ××©×ª××©?";
          switchLinkEl.textContent = "×”×ª×—×‘×¨×•×ª ×§×™×™××ª";
        }
      }

      setMode("login");

      if (switchLinkEl) {
        switchLinkEl.addEventListener("click", () => {
          setMode(mode === "login" ? "register" : "login");
        });
      }

      if (forgotPassLink) {
        forgotPassLink.addEventListener("click", async () => {
          const email = emailInput.value.trim();
          errorEl.style.display = "none";

          if (!email) {
            errorEl.textContent = "×›×“×™ ×œ××¤×¡ ×¡×™×¡××”, ×”×–×Ÿ ×§×•×“× ××ª ×›×ª×•×‘×ª ×”××™××™×™×œ ×©×œ×š ×‘×©×“×” ×œ××¢×œ×”.";
            errorEl.style.display = "block";
            return;
          }

          try {
            await auth.sendPasswordResetEmail(email);
            errorEl.textContent = "×× ×”××™××™×™×œ ×§×™×™× ×‘××¢×¨×›×ª, × ×©×œ×— ××œ×™×š ××™×™×œ ×œ××™×¤×•×¡ ×”×¡×™×¡××”.";
            errorEl.style.display = "block";
          } catch (err) {
            console.error(err);
            errorEl.textContent = "×œ× ×”×¦×œ×—× ×• ×œ×©×œ×•×— ××™×™×œ ××™×¤×•×¡. ×‘×“×•×§ ××ª ×”××™××™×™×œ ×•× ×¡×” ×©×•×‘.";
            errorEl.style.display = "block";
          }
        });
      }

      function getLocalSnapshot() {
        const data = {};
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          data[key] = localStorage.getItem(key);
        }
        return data;
      }

      function restoreFromSnapshot(snapshot) {
        if (!snapshot) return;
        Object.keys(snapshot).forEach((k) => {
          try {
            localStorage.setItem(k, snapshot[k]);
          } catch (e) {
            console.warn("localStorage set failed", k, e);
          }
        });
      }

      async function syncToCloud() {
        if (!currentUid || isSyncing) {
          pendingSync = true;
          return;
        }
        isSyncing = true;
        pendingSync = false;
        try {
          const snapshot = getLocalSnapshot();
          await db.collection("training_states").doc(currentUid).set(
            {
              storage: snapshot,
              updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            },
            { merge: true }
          );
        } catch (err) {
          console.error("syncToCloud error", err);
        } finally {
          isSyncing = false;
          if (pendingSync) syncToCloud();
        }
      }

      // ×›×œ ×©×™× ×•×™ ×‘-localStorage â†’ ×¡× ×›×¨×•×Ÿ ×œ×¢× ×Ÿ
      (function patchLocalStorage() {
        const _setItem = localStorage.setItem;
        const _removeItem = localStorage.removeItem;
        localStorage.setItem = function (key, value) {
          _setItem.call(localStorage, key, value);
          syncToCloud();
        };
        localStorage.removeItem = function (key) {
          _removeItem.call(localStorage, key);
          syncToCloud();
        };
      })();

      async function handleAuthClick() {
        loginRequested = true;

        const email = emailInput.value.trim();
        const pass  = passInput.value;
        errorEl.style.display = "none";

        if (!email || !pass) {
          errorEl.textContent = "× × ×œ××œ× ××™××™×™×œ ×•×¡×™×¡××”.";
          errorEl.style.display = "block";
          return;
        }

        try {
          if (mode === "login") {
            await auth.signInWithEmailAndPassword(email, pass);
          } else {
            await auth.createUserWithEmailAndPassword(email, pass);
          }
        } catch (err) {
          console.error(err);
          if (mode === "login") {
            if (err.code === "auth/user-not-found") {
              errorEl.textContent = "×œ× × ××¦× ××©×ª××© ×¢× ×”××™××™×™×œ ×”×–×”. × ×¡×” ×œ×™×¦×•×¨ ×—×©×‘×•×Ÿ ×—×“×©.";
            } else if (err.code === "auth/wrong-password") {
              errorEl.textContent = '×”×¡×™×¡××” ×œ× × ×›×•× ×”. ×× ×©×›×—×ª, ×œ×—×¥ ×¢×œ "×©×›×—×ª×™ ×¡×™×¡××”".';
            } else {
              errorEl.textContent = "×œ× ×”×¦×œ×—× ×• ×œ×”×ª×—×‘×¨. ×‘×“×•×§ ××ª ×”××™××™×™×œ ×•×”×¡×™×¡××” ×•× ×¡×” ×©×•×‘.";
            }
          } else {
            if (err.code === "auth/email-already-in-use") {
              errorEl.textContent = "×”××™××™×™×œ ×›×‘×¨ ×§×™×™× ×‘××¢×¨×›×ª. ×¢×‘×•×¨ ×œ××¡×š ×”×ª×—×‘×¨×•×ª.";
            } else if (err.code === "auth/weak-password") {
              errorEl.textContent = "×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×™×•×ª ×‘××•×¨×š ×©×œ 6 ×ª×•×•×™× ×œ×¤×—×•×ª.";
            } else {
              errorEl.textContent = "×œ× ×”×¦×œ×—× ×• ×œ×™×¦×•×¨ ××ª ×”×—×©×‘×•×Ÿ. ×‘×“×•×§ ××ª ×”×¤×¨×˜×™× ×•× ×¡×” ×©×•×‘.";
            }
          }
          errorEl.style.display = "block";
          return;
        }
      }

      if (btnEl) {
        btnEl.addEventListener("click", handleAuthClick);
      }

      // ×œ×—×©×™×¤×” ×œ×›×¤×ª×•×¨ ×¢× onclick
      window.handleAuthClick = handleAuthClick;

      auth.onAuthStateChanged(async (user) => {
        // ×× ×™×© ××©×ª××© ××—×•×‘×¨ ××‘×œ ×œ× ×‘×™×§×©× ×• ×œ×”×ª×—×‘×¨ (××•×˜×• ×œ×•×’×™×Ÿ) â€“ ×œ×”×ª× ×ª×§ ×•×œ×”×¨××•×ª ××¡×š ×›× ×™×¡×”
        if (user && !loginRequested) {
          try { await auth.signOut(); } catch (e) {}
          authScreenEl.style.display = "flex";
          setMode("login");
          return;
        }

        if (!user) {
          authScreenEl.style.display = "flex";
          setMode("login");
          return;
        }
        currentUid = user.uid;
        window.currentUid = currentUid;

        try {
          // Load from cloud
          const docRef = db.collection("training_states").doc(user.uid);
          const snap   = await docRef.get();

          if (snap.exists) {
            const data = snap.data();
            if (data && data.storage) {
              restoreFromSnapshot(data.storage);
            }
          } else {
            await docRef.set(
              {
                storage: getLocalSnapshot(),
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
              },
              { merge: true }
            );
          }

          // Update users/{uid} with role (× ××©×•×š ×-users ×× ×§×™×™×, ××—×¨×ª ×œ×¤×™ ××™×™×œ ×‘×¢×œ×™×)
          let resolvedRole;
          try {
            const userRef = db.collection("users").doc(user.uid);
            const userSnap = await userRef.get();
            const data = userSnap.exists ? userSnap.data() : {};

            if (data && (data.role === "owner" || data.role === "trainer" || data.role === "trainee")) {
              resolvedRole = data.role;
            } else if (user.email && user.email.toLowerCase() === OWNER_EMAIL.toLowerCase()) {
              resolvedRole = "owner";
            } else {
              resolvedRole = "trainee";
            }

            await userRef.set(
              {
                email: user.email || "",
                role: resolvedRole,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
              },
              { merge: true }
            );
          } catch (err) {
            console.error("Error resolving user role", err);
            resolvedRole =
              user.email && user.email.toLowerCase() === OWNER_EMAIL.toLowerCase()
                ? "owner"
                : "trainee";
          }

          // update UI role
          if (typeof currentUserRole !== "undefined") {
            currentUserRole = resolvedRole;
          }
          if (typeof currentUserEmail !== "undefined") {
            currentUserEmail = user.email || "";
          }
          if (typeof applyRoleToUI === "function") {
            applyRoleToUI();
          }

          // hide overlay
          authScreenEl.style.opacity = "0";
          setTimeout(() => {
            authScreenEl.style.display = "none";
          }, 220);
        } catch (err) {
          console.error("post-login error", err);
          errorEl.textContent =
            "×”×ª×—×‘×¨×ª, ××‘×œ ×”×™×™×ª×” ×‘×¢×™×” ×‘×˜×¢×™× ×ª ×”××™×“×¢ ××”×¢× ×Ÿ. × ×¡×” ×œ×¨×¢× ×Ÿ ××ª ×”×“×£.";
          errorEl.style.display = "block";
        }
      });
    });
  </script>

</body>
</html>
