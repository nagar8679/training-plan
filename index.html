<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>××¤×œ×™×§×¦×™×™×ª ××™××•× ×™× â€“ ×“×©×‘×•×¨×“ ××œ×</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg-main: #020617;
      --bg-card: #020617;
      --bg-card-soft: #0b1220;
      --accent: #f97316;
      --accent-2: #38bdf8;
      --accent-3: #22c55e;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: #1e293b;
      --shadow-soft: 0 20px 50px rgba(0,0,0,0.75);
      --radius-lg: 18px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
    }
<!-- ğŸ” ××–×•×¨ ×”×ª×—×‘×¨×•×ª -->
<div id="auth-panel" style="padding:16px; background:#111827; color:#e5e7eb; border-bottom:1px solid #1f2937;">
  <h2 style="margin:0 0 8px;">×”×ª×—×‘×¨×•×ª</h2>

  <!-- ×”×•×“×¢×•×ª ×©×’×™××”/××¦×‘ -->
  <div id="auth-message" style="color:#f97373; margin-bottom:8px; font-size:14px;"></div>

  <!-- ××™××™×™×œ + ×¡×™×¡××” -->
  <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:8px;">
    <input id="email-input" type="email" placeholder="××™××™×™×œ"
           style="padding:6px 8px; border-radius:4px; border:1px solid #374151; background:#020617; color:#e5e7eb;">
    <input id="password-input" type="password" placeholder="×¡×™×¡××”"
           style="padding:6px 8px; border-radius:4px; border:1px solid #374151; background:#020617; color:#e5e7eb;">
    <button id="login-email-btn"
            style="padding:6px 10px; border-radius:4px; border:none; background:#22c55e; color:#020617; cursor:pointer;">
      ×”×ª×—×‘×¨×•×ª
    </button>
    <button id="register-email-btn"
            style="padding:6px 10px; border-radius:4px; border:1px solid #22c55e; background:transparent; color:#bbf7d0; cursor:pointer;">
      ×”×¨×©××”
    </button>
  </div>

<!-- ğŸ” ××–×•×¨ ×”×ª×—×‘×¨×•×ª -->
<div id="auth-panel" style="padding:16px; background:#111827; color:#e5e7eb; border-bottom:1px solid #1f2937;">
  <h2 style="margin:0 0 8px;">×”×ª×—×‘×¨×•×ª</h2>

  <!-- ×”×•×“×¢×•×ª ×©×’×™××”/××¦×‘ -->
  <div id="auth-message" style="color:#f97373; margin-bottom:8px; font-size:14px;"></div>

  <!-- ××™××™×™×œ + ×¡×™×¡××” -->
  <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:8px;">
    <input id="email-input" type="email" placeholder="××™××™×™×œ"
           style="padding:6px 8px; border-radius:4px; border:1px solid #374151; background:#020617; color:#e5e7eb;">
    <input id="password-input" type="password" placeholder="×¡×™×¡××”"
           style="padding:6px 8px; border-radius:4px; border:1px solid #374151; background:#020617; color:#e5e7eb;">
    <button id="login-email-btn"
            style="padding:6px 10px; border-radius:4px; border:none; background:#22c55e; color:#020617; cursor:pointer;">
      ×”×ª×—×‘×¨×•×ª
    </button>
    <button id="register-email-btn"
            style="padding:6px 10px; border-radius:4px; border:1px solid #22c55e; background:transparent; color:#bbf7d0; cursor:pointer;">
      ×”×¨×©××”
    </button>
  </div>

  <!-- ×’×•×’×œ / ×× ×•× ×™××™ -->
  <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px;">
    <button id="google-btn"
            style="padding:6px 10px; border-radius:4px; border:none; background:#f97316; color:#020617; cursor:pointer;">
      ×”×ª×—×‘×¨ ×¢× Google
    </button>
    <button id="guest-btn"
            style="padding:6px 10px; border-radius:4px; border:1px solid #6b7280; background:transparent; color:#e5e7eb; cursor:pointer;">
      ×”××©×š ×›××•×¨×—
    </button>
  </div>

  <!-- ××¦×‘ ××©×ª××© -->
  <div style="display:flex; justify-content:space-between; align-items:center; font-size:14px;">
    <span id="user-info">×œ× ××—×•×‘×¨</span>
    <button id="logout-btn"
            style="padding:4px 8px; border-radius:4px; border:none; background:#ef4444; color:#fee2e2; cursor:pointer; display:none;">
      ×”×ª× ×ª×§
    </button>
  </div>
</div>


<script>
  // ===== DATA MODEL =====
  const program = {
    sunday: {
      title: "×™×•× ×¨××©×•×Ÿ â€“ ×—×–×” + ×›×ª×¤×™×™× + ×™×“ ××—×•×¨×™×ª",
      subtitle: "×—×–×” ×›×‘×“ + ×›×ª×£ ×§×“××™×ª/×××¦×¢×™×ª + ×˜×¨×™×™×¡×¤×¡",
      exercises: [
        {
          name: "×œ×—×™×¦×ª ×—×–×” ×‘××•×˜ (×‘× ×¥')",
          muscle: "×—×–×”",
          sets: 4, reps: "6â€“8",
          description: "×ª×¨×’×™×œ ×‘×¡×™×¡ ×œ×—×–×” ×××¦×¢×™ ×•×ª×—×ª×•×Ÿ. ×œ×©×›×‘ ×™×¦×™×‘, ×©×›××•×ª ××›×•×•×¦×•×ª ×œ××—×•×¨, ×œ×”×•×¨×™×“ ××ª ×”××•×˜ ×‘×©×œ×™×˜×” ×¢×“ ×§×¨×•×‘ ×œ×—×–×” ×•×œ×“×—×•×£ ×—×–×§ ××¢×œ×”."
        },
        {
          name: "×œ×—×™×¦×ª ×—×–×” ×‘×©×™×¤×•×¢ ×¢×œ×™×•×Ÿ ×¢× ×“×××‘×œ×™×",
          muscle: "×—×–×” ×¢×œ×™×•×Ÿ",
          sets: 4, reps: "8â€“10",
          description: "×œ×—×™×¦×” ×‘×–×•×•×™×ª 30Â° ×¢× ×“×××‘×œ×™× ×›×“×™ ×œ×¢×‘×•×“ ×¢×œ ×”×—×–×” ×”×¢×œ×™×•×Ÿ. ×œ×©××•×¨ ×¢×œ ×©×œ×™×˜×” ××œ××” ×•×ª× ×•×¢×” ×‘×§×©×ª ×˜×‘×¢×™×ª."
        },
        {
          name: "×¤×¨×¤×¨ ×‘××›×•× ×” ×œ×—×–×”",
          muscle: "×—×–×” ×××¦×¢×™",
          sets: 3, reps: "12â€“15",
          description: "×‘×™×“×•×“ ×œ×—×–×”. ×œ×¡×’×•×¨ ××ª ×”×™×“×™×™× ×¢×“ ×©×”×Ÿ ×›××¢×˜ × ×•×’×¢×•×ª, ×œ×¢×¦×•×¨ ×©× ×™×™×” ×‘×›×™×•×•×¥ ×•×œ×©×—×¨×¨ ×‘××™×˜×™×•×ª."
        },
        {
          name: "×§×¨×•×¡ ××•×‘×¨ ××œ××¢×œ×” ×œ××˜×” (×¤×•×œ×™ ×¢×œ×™×•×Ÿ)",
          muscle: "×—×–×” ×ª×—×ª×•×Ÿ",
          sets: 3, reps: "12â€“15",
          description: "×œ××©×•×š ××ª ×”×›×‘×œ×™× ×‘××œ×›×¡×•×Ÿ ××œ××¢×œ×” ×œ××˜×”, ××¨×¤×§×™× ××¢×˜ ×›×¤×•×¤×™×, ×œ×¡×™×™× ×‘×¢×¨×š ×‘×’×•×‘×” ×‘×˜×Ÿ ×¢×œ×™×•× ×”."
        },
        {
          name: "×œ×—×™×¦×ª ×›×ª×¤×™×™× ×‘××›×•× ×”",
          muscle: "×›×ª×£ ×§×“××™×ª",
          sets: 3, reps: "8â€“10",
          description: "×œ×—×™×¦×ª ×›×ª×¤×™×™× ×‘×™×©×™×‘×”. ×”×™×“×™×™× ××ª×—×™×œ×•×ª ×‘×¢×¨×š ×‘×’×•×‘×” ×›×ª×£, ×œ×“×—×•×£ ×œ××¢×œ×” ×‘×œ×™ ×œ× ×¢×•×œ ××¨×¤×§×™×."
        },
        {
          name: "×”×¨×—×§×ª ×›×ª×¤×™×™× ×œ×¦×“×“×™× ×¢× ×“×××‘×œ×™×",
          muscle: "×›×ª×£ ×××¦×¢×™×ª",
          sets: 3, reps: "12â€“15",
          description: "×œ×”×¨×™× ××ª ×”×“×××‘×œ×™× ×œ×¦×“×“×™× ×¢×“ ×’×•×‘×” ×”×›×ª×£ ×‘×œ×‘×“, ××¨×¤×§×™× ××¢×˜ ×›×¤×•×¤×™×, ×©×œ×™×˜×” ×•×œ× ×ª× ×•×¤×”."
        },
        {
          name: "×¤×©×™×˜×ª ××¨×¤×§×™× ××¢×œ ×”×¨××© ×¢× ×“×××‘×œ",
          muscle: "×™×“ ××—×•×¨×™×ª â€“ ×¨××© ××¨×•×š",
          sets: 3, reps: "10â€“12",
          description: "×™×©×™×‘×” ××• ×¢××™×“×”, ×“×××‘×œ ××—×“ ×‘×©×ª×™ ×™×“×™×™× ××¢×œ ×”×¨××©. ×œ×¨×“×ª ×¢××•×§ ×××—×•×¨×™ ×”×¨××© ×•×œ×™×™×©×¨ ×‘×©×§×˜."
        },
        {
          name: "×¤×©×™×˜×ª ××¨×¤×§×™× ×‘×—×‘×œ ×‘×¤×•×œ×™ ×¢×œ×™×•×Ÿ",
          muscle: "×™×“ ××—×•×¨×™×ª â€“ ×¨××© ×¦×“×“×™",
          sets: 3, reps: "12â€“15",
          description: "×œ×¢××•×“ ×¦××•×“ ×œ×¤×•×œ×™, ××¨×¤×§×™× ×œ×™×“ ×”×’×•×£, ×œ×“×—×•×£ ××ª ×”×—×‘×œ ×œ××˜×” ×•×œ×¤×ª×•×— ××•×ª×• ×‘×¡×•×£ ×”×˜×•×•×—."
        }
      ]
    },
    monday: {
      title: "×™×•× ×©× ×™ â€“ ×’×‘ + ×™×“ ×§×“××™×ª + ×××•×ª",
      subtitle: "×’×‘ ××œ× â€“ ×¨×•×—×‘, ×¢×•×‘×™, ×¢×œ×™×•×Ÿ ×•×ª×—×ª×•×Ÿ + ×‘×™×™×¡×¤×¡",
      exercises: [
        {
          name: "××ª×— ×‘××—×™×–×” ×¨×—×‘×”",
          muscle: "×’×‘ ×¨×—×‘",
          sets: 4, reps: "6â€“8 / 8â€“10",
          description: "×œ×ª×¤×•×¡ ×¨×—×‘ ××¢×˜ ××›×ª×£, ×œ××©×•×š ××ª ×‘×™×ª ×”×—×–×” ×œ×›×™×•×•×Ÿ ×”××•×˜, ×œ×—×©×•×‘ ×¢×œ ××©×™×›×” ×¢× ×”××¨×¤×§×™× ×œ××˜×”."
        },
        {
          name: "×—×ª×™×¨×” ×œ××•×˜ T",
          muscle: "×’×‘ ×××¦×¢×™/×¢×•×‘×™",
          sets: 4, reps: "8â€“10",
          description: "×¤×œ×’ ×’×•×£ ×¢×œ×™×•×Ÿ × ×•×˜×” ×§×“×™××”, ×’×‘ × ×™×˜×¨×œ×™, ×œ××©×•×š ××ª ×”×™×“×™×•×ª ×œ×›×™×•×•×Ÿ ×”×‘×˜×Ÿ ×ª×•×š ×©××™×¨×” ×¢×œ ×’×‘ ×—×–×§."
        },
        {
          name: "×—×ª×™×¨×” ×‘×™×©×™×‘×” ×‘×¤×•×œ×™ ×ª×—×ª×•×Ÿ",
          muscle: "×’×‘ ×××¦×¢×™",
          sets: 3, reps: "10â€“12",
          description: "×œ×©×‘×ª ×–×§×•×£, ×œ××©×•×š ××ª ×”×™×“×™×•×ª ×œ×›×™×•×•×Ÿ ×”×‘×˜×Ÿ, ×œ×”×—×–×™×§ ×©× ×™×™×” ×‘×›×™×•×•×¥ ×•×œ×©×—×¨×¨ ×œ××˜ ×§×“×™××”."
        },
        {
          name: "×¤×¨×¤×¨ ×”×¤×•×š ×‘××›×•× ×”/×¤×•×œ×™",
          muscle: "×’×‘ ×¢×œ×™×•×Ÿ + ×›×ª×£ ××—×•×¨×™×ª",
          sets: 3, reps: "12â€“15",
          description: "×œ×¤×ª×•×— ××ª ×”×™×“×™×™× ×œ××—×•×¨ ×¢×“ ×’×•×‘×” ×›×ª×£, ×œ×©××•×¨ ×¢×œ ×—×–×” ×§×“×™××” ×•×¢×œ ×ª× ×•×¢×” ××‘×•×§×¨×ª."
        },
        {
          name: "×¤×©×™×˜×ª ×’×‘ ×‘×›×™×¡× ×¨×•××™",
          muscle: "×’×‘ ×ª×—×ª×•×Ÿ",
          sets: 3, reps: "12â€“15",
          description: "×œ×›×•×¤×£ ××ª ×”×’×•×£ ×œ××˜×” ×‘××™×˜×™×•×ª ×•×œ×¢×œ×•×ª ×¢×“ ×§×• ×™×©×¨ ×¢× ×”×’×•×£, ×œ× ××¢×‘×¨ ×•×œ× ×œ× ×¢×•×œ ×’×‘."
        },
        {
          name: "×›×¤×™×¤×•×ª ××¨×¤×§×™× ×‘×¢××™×“×”",
          muscle: "×™×“ ×§×“××™×ª",
          sets: 3, reps: "10â€“12",
          description: "×œ×¢××•×“ ×™×¦×™×‘, ××¨×¤×§×™× ×¦××•×“×™× ×œ×’×•×£, ×œ×”×¢×œ×•×ª ×•×œ×¨×“×ª ×‘××™×˜×™×•×ª ×‘×œ×™ × ×¤× ×•×£."
        },
        {
          name: "×›×¤×™×¤×•×ª ×¤×˜×™×©×™× ×¢× ×“×××‘×œ×™×",
          muscle: "×™×“ ×§×“××™×ª (×‘×¨×›×™××œ×™×¡)",
          sets: 3, reps: "12",
          description: "××—×™×–×” × ×™×˜×¨×œ×™×ª (×›××™×œ×• ××—×–×™×§ ×¤×˜×™×©), ××¢×œ×” ×¢×“ ×–×•×•×™×ª 90â€“120Â° ×•×©×•×œ×˜ ×‘×™×¨×™×“×”."
        },
        {
          name: "×›×¤×™×¤×ª ×©×•×¨×© ×›×£ ×”×™×“ ×”×¤×•×›×”",
          muscle: "×××•×ª",
          sets: 3, reps: "12â€“15",
          description: "×œ×©×‘×ª, ×××•×ª ××•× ×—×•×ª, ×’×‘ ×›×£ ×”×™×“ ×œ××¢×œ×”, ×œ×”×¨×™× ××ª ×”××©×§×œ ×‘×¢×–×¨×ª ×©×•×¨×© ×›×£ ×”×™×“ ×‘×œ×‘×“."
        }
      ]
    },
    tuesday: {
      title: "×™×•× ×©×œ×™×©×™ â€“ ×¨×’×œ×™×™× + ×œ×™×‘×”",
      subtitle: "×¨×’×œ×™×™× ××œ××•×ª â€“ ×§×•×•××“×¨×™×¡×¤×¡, ××—×•×¨×™ ×”×™×¨×š, ×™×©×‘×Ÿ ×•×ª××•××™×",
      exercises: [
        {
          name: "×”××§×˜ ×¡×§×•×•××˜ ×‘××›×•× ×”",
          muscle: "×§×•×•××“ + ×™×©×‘×Ÿ",
          sets: 4, reps: "8â€“10",
          description: "×œ×¢××•×“ × ×›×•×Ÿ ×¢×œ ×”×¤×œ×˜×”, ×œ×¨×“×ª ×¢××•×§ ×ª×•×š ×©××™×¨×” ×¢×œ ×’×‘ ×¦××•×“ ×œ××©×¢× ×ª, ×œ× ×œ×™×™×©×¨ ×‘×¨×›×™×™× ×¢×“ ×”×¡×•×£."
        },
        {
          name: "×œ×—×™×¦×ª ×¨×’×œ×™×™× ×‘××›×•× ×”",
          muscle: "×›×œ ×”×¨×’×œ",
          sets: 4, reps: "10â€“12",
          description: "×¨×’×œ×™×™× ×‘×¨×•×—×‘ ×›×ª×¤×™×™×, ×œ×¤×ª×•×— ××¢×˜ ×”×—×•×¦×”, ×œ×¨×“×ª ×¢××•×§ ×•×œ×“×—×•×£ ×‘×©×œ×™×˜×”."
        },
        {
          name: "×¤×©×™×˜×ª ×‘×¨×›×™×™× ×‘××›×•× ×”",
          muscle: "×§×•×•××“×¨×™×¡×¤×¡",
          sets: 3, reps: "12â€“15",
          description: "×œ×™×™×©×¨ ××ª ×”×¨×’×œ×™×™× ×¢×“ ×›××¢×˜ × ×¢×™×œ×”, ×œ×¢×¦×•×¨ ×©× ×™×™×” ×‘×›×™×•×•×¥ ×•×œ×©×—×¨×¨ ×‘××™×˜×™×•×ª."
        },
        {
          name: "×›×¤×™×¤×ª ×‘×¨×›×™×™× ×‘×¢××™×“×”/××›×•× ×”",
          muscle: "××—×•×¨×™ ×”×™×¨×š",
          sets: 3, reps: "12â€“15",
          description: "×œ×›×•×¤×£ ××ª ×”×‘×¨×š ×›× ×’×“ ×”×ª× ×’×“×•×ª, ×œ×”×¨×’×™×© ××ª ××—×•×¨×™ ×”×™×¨×š, ×œ×©×—×¨×¨ ×œ××˜."
        },
        {
          name: "×“×“×œ×™×¤×˜ ×¨×•×× ×™ (RDL)",
          muscle: "×™×©×‘×Ÿ + ××¡×˜×¨×™× ×’",
          sets: 3, reps: "8â€“10",
          description: "×’×‘ ×™×©×¨, ×‘×¨×›×™×™× ×—×¦×™ ×›×¤×•×¤×•×ª, ×œ×”×•×¨×™×“ ××ª ×”××©×§×œ ×œ××•×¨×š ×”×¨×’×œ×™×™× ×¢×“ ××ª×™×—×” ×—×–×§×” ×‘××—×•×¨×™ ×”×™×¨×š."
        },
        {
          name: "×”×¨××ª ×¢×§×‘×™× ×‘×œ×—×™×¦×ª ×¨×’×œ×™×™×",
          muscle: "×ª××•××™× ×¢×œ×™×•×Ÿ",
          sets: 3, reps: "12â€“20",
          description: "×‘×™×©×™×‘×” ×‘××›×•× ×” ××• ×¢×œ ×”×¤×œ×˜×”, ×œ×”×•×¨×™×“ ××ª ×”×¢×§×‘×™× ×¢××•×§ ×•×œ×¢×œ×•×ª ×›××” ×©×™×•×ª×¨ ×’×‘×•×”."
        },
        {
          name: "×”×¨××ª ×¢×§×‘×™× ×‘×™×©×™×‘×” ×‘××›×•× ×”",
          muscle: "×ª××•××™× ×ª×—×ª×•×Ÿ",
          sets: 3, reps: "12â€“20",
          description: "×™×©×™×‘×”, ××©×§×œ ×¢×œ ×”×‘×¨×›×™×™×, ×¢×‘×•×“×” ××™×˜×™×ª ×•××‘×•×§×¨×ª ×‘×˜×•×•×— ××œ×."
        },
        {
          name: "×›×¤×™×¤×•×ª ×‘×˜×Ÿ ×‘××›×•× ×”",
          muscle: "×œ×™×‘×”",
          sets: 3, reps: "15",
          description: "×œ×›×•×•×¥ ××ª ×”×‘×˜×Ÿ ×•×œ× ×œ××©×•×š ×‘×™×“×™×™×, ×œ×”×•×¦×™× ××•×•×™×¨ ×‘×–××Ÿ ×”×›×™×•×•×¥."
        }
      ]
    },
    wednesday: {
      title: "×™×•× ×¨×‘×™×¢×™ â€“ ×—×–×” + ×›×ª×£ ×§×“××™×ª + ×›×ª×£ ×××¦×¢×™×ª + ×™×“ ××—×•×¨×™×ª",
      subtitle: "×©×™×œ×•×‘ × ×•×¡×£ ×œ×—×–×” + ×›×ª×¤×™×™× + ×˜×¨×™×™×¡×¤×¡",
      exercises: [
        {
          name: "×œ×—×™×¦×ª ×—×–×” ×‘×©×™×¤×•×¢ ×—×™×•×‘×™ ×¢× ×“×××‘×œ×™×",
          muscle: "×—×–×” ×¢×œ×™×•×Ÿ",
          sets: 4, reps: "8â€“10",
          description: "×›××• ×‘×™×•× ×¨××©×•×Ÿ â€“ ×“×’×© ×¢×œ ×—×–×” ×¢×œ×™×•×Ÿ, ×©×œ×™×˜×” ×‘×–×•×•×™×ª ×•×™×¦×™×‘×•×ª ×‘×›×ª×¤×™×™×."
        },
        {
          name: "×œ×—×™×¦×ª ×—×–×” ×‘×¢××™×“×” ×¢× ×›×‘×œ×™×",
          muscle: "×—×–×” ×××¦×¢×™/×ª×—×ª×•×Ÿ",
          sets: 3, reps: "10â€“12",
          description: "×œ×¢××•×“ ×‘×××¦×¢, ×œ××©×•×š ××ª ×”×™×“×™×•×ª ×§×“×™××” ×•×œ×¡×’×•×¨ ×‘×§×• ×—×–×”, ×©×œ×™×˜×” ××œ××” ×‘×›×œ ×”×˜×•×•×—."
        },
        {
          name: "×¤×¨×¤×¨ ×¢× ×›×‘×œ×™× ×‘×™×©×™×‘×”",
          muscle: "×—×–×” ×××¦×¢×™",
          sets: 3, reps: "12â€“15",
          description: "×‘×™×“×•×“ ×—×–×§, ×œ×©××•×¨ ×¢×œ ××¨×¤×§×™× ××¢×˜ ×›×¤×•×¤×™×, ×œ×¢×¦×•×¨ ×‘×©×™× ×”×›×™×•×•×¥."
        },
        {
          name: "×œ×—×™×¦×ª ×›×ª×¤×™×™× ×¢× ×“×××‘×œ×™×",
          muscle: "×›×ª×£ ×§×“××™×ª + ×××¦×¢×™×ª",
          sets: 3, reps: "8â€“10",
          description: "×™×©×™×‘×” ×–×§×•×¤×”, ×“×××‘×œ×™× ×‘×¦×“ ×”×¨××©, ×œ×“×—×•×£ ×œ××¢×œ×” ×‘×œ×™ × ×¢×™×œ×” ×—×“×”."
        },
        {
          name: "×”×¨×—×§×ª ×›×ª×¤×™×™× ×œ×¦×“×“×™×",
          muscle: "×›×ª×£ ×××¦×¢×™×ª",
          sets: 3, reps: "12â€“15",
          description: "×›××• ×‘×™×•× ×¨××©×•×Ÿ â€“ ×“×’×© ×¢×œ ×¨×•×—×‘ ×›×ª×£."
        },
        {
          name: "×¤×©×™×˜×ª ××¨×¤×§×™× ××¢×œ ×”×¨××© ×¢× ×“×××‘×œ",
          muscle: "×™×“ ××—×•×¨×™×ª â€“ ×¨××© ××¨×•×š",
          sets: 3, reps: "10â€“12",
          description: "×›××• ×‘×™×•× ×¨××©×•×Ÿ â€“ ×“×’×© ×¢×œ ×¨××© ××¨×•×š ×©×œ ×”×˜×¨×™×™×¡×¤×¡."
        },
        {
          name: "×¤×©×™×˜×ª ××¨×¤×§×™× ×‘×—×‘×œ ×‘×¤×•×œ×™ ×¢×œ×™×•×Ÿ",
          muscle: "×™×“ ××—×•×¨×™×ª â€“ ×¨××© ×¦×“×“×™",
          sets: 3, reps: "12â€“15",
          description: "×›××• ×‘×™×•× ×¨××©×•×Ÿ â€“ ×“×’×© ×¢×œ ×¨××© ×¦×“×“×™ ×•×”×©×œ××ª × ×¤×—."
        }
      ]
    },
    Thursday: {
      title: "×™×•× ×—××™×©×™ â€“ ×’×‘ + ×™×“ ×§×“××™×ª + ×××•×ª",
      subtitle: "×’×‘ ×©× ×™ ×‘×©×‘×•×¢ + ×‘×™×™×¡×¤×¡ ×•×××•×ª ××—×“×©",
      exercises: [
        {
          name: "××ª×— ×‘××—×™×–×” ×¨×—×‘×”",
          muscle: "×’×‘ ×¨×—×‘",
          sets: 4, reps: "6â€“8 / 8â€“10",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ××“×’×™×© ×¨×—×‘ ×”×’×‘."
        },
        {
          name: "×—×ª×™×¨×” ×œ××•×˜ T",
          muscle: "×’×‘ ×××¦×¢×™/×¢×•×‘×™",
          sets: 4, reps: "8â€“10",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ×¢×•×‘×™ ×”×’×‘."
        },
        {
          name: "×—×ª×™×¨×” ×‘×™×©×™×‘×” ×‘×¤×•×œ×™ ×ª×—×ª×•×Ÿ",
          muscle: "×’×‘ ×××¦×¢×™",
          sets: 3, reps: "10â€“12",
          description: "×—×–×¨×” ×¢×œ ×ª×‘× ×™×ª ×™×¦×™×‘×” ×œ×¢×•××¡ × ×•×¡×£."
        },
        {
          name: "×¤×¨×¤×¨ ×”×¤×•×š",
          muscle: "×’×‘ ×¢×œ×™×•×Ÿ + ×›×ª×£ ××—×•×¨×™×ª",
          sets: 3, reps: "12â€“15",
          description: "×“×’×© × ×•×¡×£ ×¢×œ ×™×¦×™×‘×” ×•×›×ª×£ ××—×•×¨×™×ª."
        },
        {
          name: "×¤×©×™×˜×ª ×’×‘ ×‘×›×™×¡× ×¨×•××™",
          muscle: "×’×‘ ×ª×—×ª×•×Ÿ",
          sets: 3, reps: "12â€“15",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ×—×™×–×•×§ ×–×•×§×¤×™ ×’×‘."
        },
        {
          name: "×›×¤×™×¤×•×ª ××¨×¤×§×™× ×‘×¢××™×“×”",
          muscle: "×™×“ ×§×“××™×ª",
          sets: 3, reps: "10â€“12",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ×”××©×š × ×¤×— ×œ×‘×™×™×¡×¤×¡."
        },
        {
          name: "×›×¤×™×¤×•×ª ×¤×˜×™×©×™× ×¢× ×“×××‘×œ×™×",
          muscle: "×™×“ ×§×“××™×ª",
          sets: 3, reps: "12",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ×“×’×© ×¢×œ ×‘×¨×›×™××œ×™×¡ ×•×××•×ª."
        },
        {
          name: "×›×¤×™×¤×ª ×©×•×¨×© ×›×£ ×”×™×“ ×”×¤×•×›×”",
          muscle: "×××•×ª",
          sets: 3, reps: "12â€“15",
          description: "×›××• ×‘×™×•× ×©× ×™ â€“ ××—×™×–×” ×—×–×§×”."
        }
      ]
    },
    friday: {
      title: "×™×•× ×©×™×©×™ â€“ ×¨×’×œ×™×™× + ×œ×™×‘×”",
      subtitle: "×¨×’×œ×™×™× ×©× ×™ â€“ ×“×’×© × ×•×¡×£ ×¢×œ ×™×©×‘×Ÿ, ××—×•×¨×™ ×”×™×¨×š ×•×ª××•××™×",
      exercises: [
        {
          name: "×”××§×˜ ×¡×§×•×•××˜ ×‘××›×•× ×”",
          muscle: "×§×•×•××“ + ×™×©×‘×Ÿ",
          sets: 4, reps: "8â€“10",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ ×“×’×© × ×•×¡×£."
        },
        {
          name: "×œ×—×™×¦×ª ×¨×’×œ×™×™× ×‘××›×•× ×”",
          muscle: "×›×œ ×”×¨×’×œ",
          sets: 4, reps: "10â€“12",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ × ×¤×— × ×•×¡×£."
        },
        {
          name: "×¤×©×™×˜×ª ×‘×¨×›×™×™× ×‘××›×•× ×”",
          muscle: "×§×•×•××“×¨×™×¡×¤×¡",
          sets: 3, reps: "12â€“15",
          description: "×‘×™×“×•×“ × ×•×¡×£ ×œ×§×•×•××“."
        },
        {
          name: "×›×¤×™×¤×ª ×‘×¨×›×™×™× ×‘×¢××™×“×”/××›×•× ×”",
          muscle: "××—×•×¨×™ ×”×™×¨×š",
          sets: 3, reps: "12â€“15",
          description: "×¢×•×“ × ×¤×— ×œ××¡×˜×¨×™× ×’."
        },
        {
          name: "×“×“×œ×™×¤×˜ ×¨×•×× ×™ (RDL)",
          muscle: "×™×©×‘×Ÿ + ××¡×˜×¨×™× ×’",
          sets: 3, reps: "8â€“10",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ ×ª×¨×’×™×œ ×—×•×‘×”."
        },
        {
          name: "×”×¨××ª ×¢×§×‘×™× ×‘×œ×—×™×¦×ª ×¨×’×œ×™×™×",
          muscle: "×ª××•××™× ×¢×œ×™×•×Ÿ",
          sets: 3, reps: "12â€“20",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ × ×¤×— × ×•×¡×£."
        },
        {
          name: "×”×¨××ª ×¢×§×‘×™× ×‘×™×©×™×‘×” ×‘××›×•× ×”",
          muscle: "×ª××•××™× ×ª×—×ª×•×Ÿ",
          sets: 3, reps: "12â€“20",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ ×”××©×š ×¢×‘×•×“×”."
        },
        {
          name: "×›×¤×™×¤×•×ª ×‘×˜×Ÿ ×‘××›×•× ×”",
          muscle: "×œ×™×‘×”",
          sets: 3, reps: "15",
          description: "×›××• ×‘×™×•× ×©×œ×™×©×™ â€“ ×—×™×–×•×§ ×‘×˜×Ÿ."
        }
      ]
    }
  };

  const dayOrder = [
    { key: "sunday", label: "×¨××©×•×Ÿ" },
    { key: "monday", label: "×©× ×™" },
    { key: "tuesday", label: "×©×œ×™×©×™" },
    { key: "wednesday", label: "×¨×‘×™×¢×™" },
    { key: "Thursday", label: "×—××™×©×™" },
    { key: "friday", label: "×©×™×©×™" }
  ];

  // ===== DOM REFS =====
  const pages = {
    dashboard: document.getElementById("dashboard"),
    workout: document.getElementById("workout"),
    library: document.getElementById("library"),
    history: document.getElementById("history"),
    prs: document.getElementById("prs"),
    settings: document.getElementById("settings")
  };
  const mainPageTitle = document.getElementById("mainPageTitle");
  const mainPageSubtitle = document.getElementById("mainPageSubtitle");

  const navItems = document.querySelectorAll(".nav-item");

  const dayButtonsContainer = document.getElementById("dayButtons");
  const dayTitleEl = document.getElementById("dayTitle");
  const daySubtitleEl = document.getElementById("daySubtitle");
  const exerciseTableBody = document.getElementById("exerciseTableBody");
  const dateInput = document.getElementById("workoutDate");
  const resetDayBtn = document.getElementById("resetDayBtn");
  const goWorkoutModeBtn = document.getElementById("goWorkoutModeBtn");
  const dayHistoryList = document.getElementById("dayHistoryList");
  const exerciseSelect = document.getElementById("exerciseSelect");
  const exportCsvBtn = document.getElementById("exportCsvBtn");
  const historyContainer = document.getElementById("historyContainer");
  const prGrid = document.getElementById("prGrid");

  // workout mode
  const workoutDaySelect = document.getElementById("workoutDaySelect");
  const workoutModeDate = document.getElementById("workoutModeDate");
  const workoutExName = document.getElementById("workoutExName");
  const workoutExMuscle = document.getElementById("workoutExMuscle");
  const workoutSetsRepsTag = document.getElementById("workoutSetsRepsTag");
  const workoutIndexTag = document.getElementById("workoutIndexTag");
  const currentSetLabel = document.getElementById("currentSetLabel");
  const finishSetBtn = document.getElementById("finishSetBtn");
  const nextExerciseBtn = document.getElementById("nextExerciseBtn");
  const workoutWeightInput = document.getElementById("workoutWeightInput");
  const saveWorkoutWeightBtn = document.getElementById("saveWorkoutWeightBtn");
  const restSelect = document.getElementById("restSelect");
  const startRestBtn = document.getElementById("startRestBtn");
  const restTimerDisplay = document.getElementById("restTimerDisplay");
  const workoutExerciseList = document.getElementById("workoutExerciseList");

  // settings
  const defaultRestSelect = document.getElementById("defaultRestSelect");
  const resetAllDataBtn = document.getElementById("resetAllDataBtn");

  const exerciseLibraryGrid = document.getElementById("exerciseLibraryGrid");

  let currentDayKey = "sunday";
  let chart;
  let currentChartExerciseIndex = 0;
  let restTimerId = null;
  let restRemaining = 0;
  let workoutCurrentExerciseIndex = 0;
  let workoutCurrentSet = 1;

  // ===== HELPERS: STORAGE KEYS =====
  function storageKey(dayKey, index, field) {
    return `training_${dayKey}_ex${index}_${field}`;
  }

  function dateStorageKey(dayKey) {
    return `training_${dayKey}_date`;
  }

  function historyKey(dayKey, index) {
    return `training_history_${dayKey}_ex${index}`;
  }

  function defaultRestKey() {
    return `training_default_rest`;
  }

  function loadHistory(dayKey, index) {
    try {
      const raw = localStorage.getItem(historyKey(dayKey, index));
      if (!raw) return [];
      const arr = JSON.parse(raw);
      if (!Array.isArray(arr)) return [];
      return arr;
    } catch {
      return [];
    }
  }

  function saveHistory(dayKey, index, history) {
    localStorage.setItem(historyKey(dayKey, index), JSON.stringify(history));
  }

  function addHistoryEntry(dayKey, index, dateStr, weightStr) {
    if (!dateStr || !weightStr) return;
    const weight = parseFloat(weightStr);
    if (isNaN(weight) || weight <= 0) return;
    const history = loadHistory(dayKey, index);
    const last = history[history.length - 1];
    if (last && last.date === dateStr && parseFloat(last.weight) === weight) return;
    const now = new Date();
    history.push({ date: dateStr, weight, ts: now.toISOString() });
    if (history.length > 60) history.shift();
    saveHistory(dayKey, index, history);
  }

  // ===== RENDER DAY (DASHBOARD) =====
  function renderDay(dayKey) {
    currentDayKey = dayKey;
    const dayData = program[dayKey];
    if (!dayData) return;

    dayTitleEl.textContent = dayData.title;
    daySubtitleEl.textContent = dayData.subtitle || "";

    Array.from(dayButtonsContainer.children).forEach(btn => {
      btn.classList.toggle("active", btn.dataset.dayKey === dayKey);
    });

    const savedDate = localStorage.getItem(dateStorageKey(dayKey));
    dateInput.value = savedDate || "";

    exerciseTableBody.innerHTML = "";

    dayData.exercises.forEach((ex, index) => {
      const tr = document.createElement("tr");

      const tdName = document.createElement("td");
      tdName.className = "name-col";
      tdName.textContent = ex.name;
      tr.appendChild(tdName);

      const tdSetsReps = document.createElement("td");
      tdSetsReps.textContent = `${ex.sets} Ã— ${ex.reps}`;
      tr.appendChild(tdSetsReps);

      const tdMuscle = document.createElement("td");
      tdMuscle.className = "muscle-col";
      const badge = document.createElement("span");
      badge.className = "badge-muscle";
      const dot = document.createElement("span");
      dot.className = "dot";
      const text = document.createTextNode(ex.muscle);
      badge.appendChild(dot);
      badge.appendChild(text);
      tdMuscle.appendChild(badge);
      tr.appendChild(tdMuscle);

      const tdSetsDone = document.createElement("td");
      const setsWrapper = document.createElement("div");
      setsWrapper.className = "sets-dots";
      const storedSets = parseInt(localStorage.getItem(storageKey(dayKey, index, "setsDone")) || "0", 10);
      for (let s = 1; s <= ex.sets; s++) {
        const dotEl = document.createElement("button");
        dotEl.type = "button";
        dotEl.className = "set-dot" + (s <= storedSets ? " active" : "");
        dotEl.addEventListener("click", () => {
          const current = parseInt(localStorage.getItem(storageKey(dayKey, index, "setsDone")) || "0", 10);
          let newVal = s;
          if (current === s) {
            newVal = s - 1;
          }
          localStorage.setItem(storageKey(dayKey, index, "setsDone"), newVal.toString());
          renderDay(dayKey);
        });
        setsWrapper.appendChild(dotEl);
      }
      tdSetsDone.appendChild(setsWrapper);
      tr.appendChild(tdSetsDone);

      const tdWeight = document.createElement("td");
      const weightInput = document.createElement("input");
      weightInput.type = "number";
      weightInput.step = "0.5";
      weightInput.placeholder = "××©×§×œ";
      weightInput.value = localStorage.getItem(storageKey(dayKey, index, "weight")) || "";
      weightInput.addEventListener("input", () => {
        localStorage.setItem(storageKey(dayKey, index, "weight"), weightInput.value);
        if (dateInput.value) {
          addHistoryEntry(dayKey, index, dateInput.value, weightInput.value);
          renderDayHistory(dayKey);
          updateChart();
          renderPRs();
          renderHistoryPage();
        }
      });
      tdWeight.appendChild(weightInput);
      tr.appendChild(tdWeight);

      const tdNotes = document.createElement("td");
      const notesInput = document.createElement("input");
      notesInput.type = "text";
      notesInput.placeholder = "×”×¢×¨×” (×¡×˜×™×, ×§×•×©×™, RIR...)";
      notesInput.value = localStorage.getItem(storageKey(dayKey, index, "notes")) || "";
      notesInput.addEventListener("input", () => {
        localStorage.setItem(storageKey(dayKey, index, "notes"), notesInput.value);
      });
      tdNotes.appendChild(notesInput);
      tr.appendChild(tdNotes);

      exerciseTableBody.appendChild(tr);
    });

    populateExerciseSelect();
    renderDayHistory(dayKey);
    updateChart();
    populateWorkoutDaySelect();
    populateWorkoutExerciseList();
    renderPRs();
    renderHistoryPage();
  }

  function renderDayHistory(dayKey) {
    dayHistoryList.innerHTML = "";
    const dayData = program[dayKey];
    if (!dayData) return;
    const items = [];
    dayData.exercises.forEach((ex, index) => {
      const history = loadHistory(dayKey, index);
      history.forEach(h => {
        items.push({
          exName: ex.name,
          date: h.date,
          weight: h.weight,
          ts: h.ts || h.date
        });
      });
    });
    items.sort((a, b) => (a.ts || "").localeCompare(b.ts || ""));
    const lastTen = items.slice(-10);
    lastTen.reverse();
    lastTen.forEach(item => {
      const li = document.createElement("li");
      li.className = "history-item";
      const labelSpan = document.createElement("span");
      labelSpan.className = "label";
      labelSpan.textContent = `${item.exName}`;
      const metaSpan = document.createElement("span");
      metaSpan.className = "meta";
      metaSpan.textContent = `${item.date} â€¢ ${item.weight} ×§×´×’`;
      li.appendChild(labelSpan);
      li.appendChild(metaSpan);
      dayHistoryList.appendChild(li);
    });
    if (lastTen.length === 0) {
      const li = document.createElement("li");
      li.className = "history-item";
      li.innerHTML = `<span class="label">××™×Ÿ ×”×™×¡×˜×•×¨×™×” ×œ×™×•× ×”×–×” ×¢×“×™×™×Ÿ</span><span class="meta">×ª×ª×—×™×œ ×œ×”×–×™×Ÿ ××©×§×œ×™×</span>`;
      dayHistoryList.appendChild(li);
    }
  }

  function populateExerciseSelect() {
    const dayData = program[currentDayKey];
    exerciseSelect.innerHTML = "";
    dayData.exercises.forEach((ex, index) => {
      const opt = document.createElement("option");
      opt.value = index;
      opt.textContent = ex.name;
      exerciseSelect.appendChild(opt);
    });
    currentChartExerciseIndex = 0;
    exerciseSelect.value = "0";
  }

  function updateChart() {
    const dayData = program[currentDayKey];
    if (!dayData) return;
    const ex = dayData.exercises[currentChartExerciseIndex];
    const history = loadHistory(currentDayKey, currentChartExerciseIndex);

    const labels = history.map((h, i) => h.date || `××™××•×Ÿ ${i + 1}`);
    const values = history.map(h => h.weight);

    const ctx = document.getElementById("progressChart").getContext("2d");

    if (chart) {
      chart.destroy();
    }

    chart = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: ex.name,
          data: values,
          tension: 0.3,
          fill: true,
          borderColor: "#f97316",
          backgroundColor: "rgba(249,115,22,0.22)",
          pointRadius: 3,
          pointBackgroundColor: "#fed7aa"
        }]
      },
      options: {
        plugins: {
          legend: {
            labels: {
              font: { size: 11 },
              color: "#e5e7eb"
            }
          }
        },
        scales: {
          x: {
            ticks: { color: "#9ca3af", font: { size: 10 } },
            grid: { color: "rgba(55,65,81,0.4)" }
          },
          y: {
            ticks: { color: "#9ca3af", font: { size: 10 } },
            grid: { color: "rgba(55,65,81,0.4)" }
          }
        }
      }
    });
  }

  // ===== WORKOUT MODE =====
  function populateWorkoutDaySelect() {
    workoutDaySelect.innerHTML = "";
    dayOrder.forEach(d => {
      const opt = document.createElement("option");
      opt.value = d.key;
      opt.textContent = d.label;
      workoutDaySelect.appendChild(opt);
    });
    workoutDaySelect.value = currentDayKey;
  }

  function populateWorkoutExerciseList() {
    const dayKey = workoutDaySelect.value || currentDayKey;
    const dayData = program[dayKey];
    workoutExerciseList.innerHTML = "";
    if (!dayData) return;
    dayData.exercises.forEach((ex, index) => {
      const li = document.createElement("li");
      li.className = "workout-list-item" + (index === workoutCurrentExerciseIndex ? " active" : "");
      const left = document.createElement("span");
      left.textContent = ex.name;
      const right = document.createElement("span");
      right.textContent = `${ex.sets} Ã— ${ex.reps}`;
      li.appendChild(left);
      li.appendChild(right);
      li.addEventListener("click", () => {
        workoutCurrentExerciseIndex = index;
        workoutCurrentSet = 1;
        renderWorkoutCurrent();
      });
      workoutExerciseList.appendChild(li);
    });
  }

  function renderWorkoutCurrent() {
    const dayKey = workoutDaySelect.value || currentDayKey;
    const dayData = program[dayKey];
    if (!dayData) return;
    const ex = dayData.exercises[workoutCurrentExerciseIndex];
    if (!ex) return;

    workoutExName.textContent = ex.name;
    workoutExMuscle.textContent = ex.muscle;
    workoutSetsRepsTag.textContent = `${ex.sets} Ã— ${ex.reps}`;
    workoutIndexTag.textContent = `×ª×¨×’×™×œ ${workoutCurrentExerciseIndex + 1} ××ª×•×š ${dayData.exercises.length}`;
    currentSetLabel.textContent = workoutCurrentSet.toString();

    const storedWeight = localStorage.getItem(storageKey(dayKey, workoutCurrentExerciseIndex, "weight"));
    workoutWeightInput.value = storedWeight || "";

    Array.from(workoutExerciseList.children).forEach((li, idx) => {
      li.classList.toggle("active", idx === workoutCurrentExerciseIndex);
    });

    const savedDate = localStorage.getItem(dateStorageKey(dayKey));
    if (savedDate) {
      workoutModeDate.value = savedDate;
    }
  }

  function startRestTimer(seconds) {
    if (restTimerId) {
      clearInterval(restTimerId);
      restTimerId = null;
    }
    restRemaining = seconds;
    updateRestDisplay();
    restTimerId = setInterval(() => {
      restRemaining--;
      if (restRemaining <= 0) {
        clearInterval(restTimerId);
        restTimerId = null;
        restRemaining = 0;
      }
      updateRestDisplay();
    }, 1000);
  }

  function updateRestDisplay() {
    const m = Math.floor(restRemaining / 60);
    const s = restRemaining % 60;
    const mm = m.toString().padStart(2, "0");
    const ss = s.toString().padStart(2, "0");
    restTimerDisplay.textContent = `${mm}:${ss}`;
  }

  // ===== EXERCISE LIBRARY =====
  function renderExerciseLibrary() {
    exerciseLibraryGrid.innerHTML = "";
    dayOrder.forEach(d => {
      const dayData = program[d.key];
      if (!dayData) return;
      dayData.exercises.forEach(ex => {
        const card = document.createElement("div");
        card.className = "exercise-card";
        const h4 = document.createElement("h4");
        h4.textContent = ex.name;
        const muscle = document.createElement("div");
        muscle.className = "muscle";
        muscle.textContent = ex.muscle;
        const p = document.createElement("p");
        p.textContent = ex.description || "";
        card.appendChild(h4);
        card.appendChild(muscle);
        card.appendChild(p);
        exerciseLibraryGrid.appendChild(card);
      });
    });
  }

  // ===== HISTORY PAGE =====
  function renderHistoryPage() {
    historyContainer.innerHTML = "";
    const allEntries = [];
    dayOrder.forEach(d => {
      const dayKey = d.key;
      const dayData = program[dayKey];
      if (!dayData) return;
      dayData.exercises.forEach((ex, index) => {
        const history = loadHistory(dayKey, index);
        history.forEach(h => {
          allEntries.push({
            dayKey,
            dayLabel: d.label,
            exName: ex.name,
            date: h.date,
            weight: h.weight,
            ts: h.ts || (h.date + "T00:00:00")
          });
        });
      });
    });
    if (allEntries.length === 0) {
      const p = document.createElement("p");
      p.className = "small-note";
      p.textContent = "××™×Ÿ ×¢×“×™×™×Ÿ ×”×™×¡×˜×•×¨×™×™×ª ××™××•× ×™×. ××œ× ××©×§×œ×™× ×‘×“×©×‘×•×¨×“ ×•×ª×ª×—×™×œ ×œ×‘× ×•×ª ×™×•××Ÿ.";
      historyContainer.appendChild(p);
      return;
    }

    allEntries.sort((a, b) => (a.ts || "").localeCompare(b.ts || ""));
    const groups = {};
    allEntries.forEach(e => {
      const key = `${e.date}__${e.dayLabel}`;
      if (!groups[key]) groups[key] = [];
      groups[key].push(e);
    });

    Object.keys(groups).forEach(groupKey => {
      const [date, dayLabel] = groupKey.split("__");
      const div = document.createElement("div");
      div.className = "history-group";
      const title = document.createElement("div");
      title.className = "history-group-title";
      title.textContent = `${date} â€“ ×™×•× ${dayLabel}`;
      div.appendChild(title);
      const ul = document.createElement("ul");
      ul.className = "history-group-list";
      groups[groupKey].forEach(e => {
        const li = document.createElement("li");
        li.innerHTML = `<span>${e.exName}</span><span>${e.weight} ×§×´×’</span>`;
        ul.appendChild(li);
      });
      div.appendChild(ul);
      historyContainer.appendChild(div);
    });
  }

  // ===== PR PAGE =====
  function renderPRs() {
    prGrid.innerHTML = "";
    dayOrder.forEach(d => {
      const dayKey = d.key;
      const dayData = program[dayKey];
      if (!dayData) return;
      dayData.exercises.forEach((ex, index) => {
        const history = loadHistory(dayKey, index);
        if (!history.length) return;
        let maxEntry = history[0];
        history.forEach(h => {
          if (parseFloat(h.weight) > parseFloat(maxEntry.weight)) {
            maxEntry = h;
          }
        });
        const card = document.createElement("div");
        card.className = "pr-card";
        const h4 = document.createElement("h4");
        h4.textContent = ex.name;
        const val = document.createElement("div");
        val.className = "pr-value";
        val.textContent = `${maxEntry.weight} ×§×´×’`;
        const meta = document.createElement("div");
        meta.className = "pr-meta";
        meta.textContent = `×©×™× ×‘×™×•× ${maxEntry.date} â€¢ ×™×•× ${d.label}`;
        card.appendChild(h4);
        card.appendChild(val);
        card.appendChild(meta);
        prGrid.appendChild(card);
      });
    });
    if (!prGrid.children.length) {
      const p = document.createElement("p");
      p.className = "small-note";
      p.textContent = "××™×Ÿ ×¢×“×™×™×Ÿ ×©×™××™×, ×¦×¨×™×š ×œ×”×–×™×Ÿ ××¡×¤×¨ ××™××•× ×™× ×¢× ××©×§×œ×™× ×›×“×™ ×œ×—×©×‘ PR.";
      prGrid.appendChild(p);
    }
  }

  // ===== EXPORT CSV =====
  function exportHistoryToCsv() {
    const rows = [["day_key", "day_label", "date", "exercise", "weight", "timestamp"]];
    dayOrder.forEach(d => {
      const dayKey = d.key;
      const dayData = program[dayKey];
      if (!dayData) return;
      dayData.exercises.forEach((ex, index) => {
        const history = loadHistory(dayKey, index);
        history.forEach(h => {
          rows.push([
            dayKey,
            d.label,
            h.date,
            ex.name,
            h.weight,
            h.ts || ""
          ]);
        });
      });
    });
    if (rows.length === 1) {
      alert("××™×Ÿ × ×ª×•× ×™ ×”×™×¡×˜×•×¨×™×” ×œ×™×™×¦×.");
      return;
    }
    let csv = "";
    rows.forEach(r => {
      csv += r.map(v => `"${String(v).replace(/"/g, '""')}"`).join(",") + "\n";
    });
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "training-history.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // ===== SETTINGS =====
  function loadDefaultRest() {
    const val = localStorage.getItem(defaultRestKey());
    const useVal = val || "90";
    defaultRestSelect.value = useVal;
    restSelect.value = useVal;
  }

  function saveDefaultRest() {
    const val = defaultRestSelect.value || "90";
    localStorage.setItem(defaultRestKey(), val);
    restSelect.value = val;
  }

  function resetAllData() {
    if (!confirm("×œ××—×•×§ ××ª ×›×œ ×”× ×ª×•× ×™× (××©×§×œ×™×, ×”×¢×¨×•×ª, ×”×™×¡×˜×•×¨×™×”, ×©×™××™×) ××”××›×©×™×¨ ×”×–×”?")) return;
    Object.keys(localStorage)
      .filter(k => k.startsWith("training_"))
      .forEach(k => localStorage.removeItem(k));
    renderDay(currentDayKey);
    renderHistoryPage();
    renderPRs();
    alert("×›×œ ×”× ×ª×•× ×™× × ××—×§×• ××”××›×©×™×¨ ×”×–×”. ××¤×©×¨ ×œ×”×ª×—×™×œ ×××¤×¡.");
  }

  // ===== NAVIGATION =====
  function setActivePage(pageKey) {
    Object.keys(pages).forEach(key => {
      pages[key].classList.toggle("active", key === pageKey);
    });
    navItems.forEach(item => {
      item.classList.toggle("active", item.dataset.page === pageKey);
    });
    switch (pageKey) {
      case "dashboard":
        mainPageTitle.textContent = "×“×©×‘×•×¨×“ ××™××•× ×™× ×©×‘×•×¢×™";
        mainPageSubtitle.textContent = "××¢×§×‘ ××©×§×œ×™×, ×¡×˜×™× ×•×”×ª×§×“××•×ª ×œ××•×¨×š ×–××Ÿ.";
        break;
      case "workout":
        mainPageTitle.textContent = "××¦×‘ ××™××•×Ÿ â€“ ×‘×™×¦×•×¢ ×¡×˜×™× ×‘×–××Ÿ ×××ª";
        mainPageSubtitle.textContent = "×”×ª××§×“×•×ª ×‘×ª×¨×’×™×œ ××—×“, ×¡×˜×™×, ×˜×™×™××¨ ×× ×•×—×” ×•××¢×‘×¨ ××•×˜×•××˜×™.";
        break;
      case "library":
        mainPageTitle.textContent = "×¡×¤×¨×™×™×ª ×ª×¨×’×™×œ×™× ××œ××”";
        mainPageSubtitle.textContent = "×”×‘× ×” ××” ×¢×•×©×” ×›×œ ×ª×¨×’×™×œ ×•××™×š ×œ×‘×¦×¢ × ×›×•×Ÿ.";
        renderExerciseLibrary();
        break;
      case "history":
        mainPageTitle.textContent = "×™×•××Ÿ ××™××•× ×™×";
        mainPageSubtitle.textContent = "×›×œ ×”××™××•× ×™×, ×›×œ ×”×ª××¨×™×›×™×, ×”×›×œ ×‘××§×•× ××—×“.";
        renderHistoryPage();
        break;
      case "prs":
        mainPageTitle.textContent = "×©×™××™× ××™×©×™×™× (PRs)";
        mainPageSubtitle.textContent = "××©×§×œ×™× ×”×›×™ ×—×–×§×™× ×©×”×¨××ª ×‘×›×œ ×ª×¨×’×™×œ.";
        renderPRs();
        break;
      case "settings":
        mainPageTitle.textContent = "×”×’×“×¨×•×ª ××¤×œ×™×§×¦×™×”";
        mainPageSubtitle.textContent = "×©×œ×™×˜×” ×¢×œ ×× ×•×—×”, ××™×¤×•×¡×™× ×•×”×¢×“×¤×•×ª.";
        break;
    }
  }

  // ===== INIT =====
  // nav
  navItems.forEach(item => {
    item.addEventListener("click", () => {
      const pageKey = item.dataset.page;
      setActivePage(pageKey);
    });
  });

  // day buttons
  dayOrder.forEach(d => {
    const btn = document.createElement("button");
    btn.className = "day-button" + (d.key === currentDayKey ? " active" : "");
    btn.dataset.dayKey = d.key;
    const dot = document.createElement("span");
    dot.className = "dot";
    btn.appendChild(dot);
    btn.appendChild(document.createTextNode("×™×•× " + d.label));
    btn.addEventListener("click", () => {
      renderDay(d.key);
    });
    dayButtonsContainer.appendChild(btn);
  });

  dateInput.addEventListener("change", () => {
    localStorage.setItem(dateStorageKey(currentDayKey), dateInput.value);
  });

  resetDayBtn.addEventListener("click", () => {
    if (!confirm("×œ××¤×¡ ××ª ×›×œ ×”××©×§×œ×™×, ×”×”×¢×¨×•×ª, ×”×¡×˜×™× ×•×”×”×™×¡×˜×•×¨×™×” ×œ×™×•× ×”×–×”?")) return;
    const dayData = program[currentDayKey];
    dayData.exercises.forEach((_, index) => {
      localStorage.removeItem(storageKey(currentDayKey, index, "weight"));
      localStorage.removeItem(storageKey(currentDayKey, index, "notes"));
      localStorage.removeItem(storageKey(currentDayKey, index, "setsDone"));
      localStorage.removeItem(historyKey(currentDayKey, index));
    });
    localStorage.removeItem(dateStorageKey(currentDayKey));
    renderDay(currentDayKey);
  });

  goWorkoutModeBtn.addEventListener("click", () => {
    setActivePage("workout");
  });

  exerciseSelect.addEventListener("change", () => {
    currentChartExerciseIndex = parseInt(exerciseSelect.value, 10) || 0;
    updateChart();
  });

  exportCsvBtn.addEventListener("click", exportHistoryToCsv);

  // workout mode events
  workoutDaySelect.addEventListener("change", () => {
    workoutCurrentExerciseIndex = 0;
    workoutCurrentSet = 1;
    populateWorkoutExerciseList();
    renderWorkoutCurrent();
  });

  workoutModeDate.addEventListener("change", () => {
    const dayKey = workoutDaySelect.value || currentDayKey;
    localStorage.setItem(dateStorageKey(dayKey), workoutModeDate.value);
    if (dayKey === currentDayKey) {
      dateInput.value = workoutModeDate.value;
    }
  });

  finishSetBtn.addEventListener("click", () => {
    const dayKey = workoutDaySelect.value || currentDayKey;
    const dayData = program[dayKey];
    const ex = dayData.exercises[workoutCurrentExerciseIndex];
    const currentStored = parseInt(localStorage.getItem(storageKey(dayKey, workoutCurrentExerciseIndex, "setsDone")) || "0", 10);
    const newVal = Math.min(currentStored + 1, ex.sets);
    localStorage.setItem(storageKey(dayKey, workoutCurrentExerciseIndex, "setsDone"), newVal.toString());
    workoutCurrentSet = Math.min(newVal + 1, ex.sets);
    currentSetLabel.textContent = workoutCurrentSet.toString();
    if (dayKey === currentDayKey) {
      renderDay(dayKey);
    }
  });

  nextExerciseBtn.addEventListener("click", () => {
    const dayKey = workoutDaySelect.value || currentDayKey;
    const dayData = program[dayKey];
    workoutCurrentExerciseIndex = (workoutCurrentExerciseIndex + 1) % dayData.exercises.length;
    workoutCurrentSet = 1;
    renderWorkoutCurrent();
  });

  saveWorkoutWeightBtn.addEventListener("click", () => {
    const dayKey = workoutDaySelect.value || currentDayKey;
    const dayData = program[dayKey];
    const ex = dayData.exercises[workoutCurrentExerciseIndex];
    const weight = workoutWeightInput.value;
    localStorage.setItem(storageKey(dayKey, workoutCurrentExerciseIndex, "weight"), weight);
    const dateStr = workoutModeDate.value || dateInput.value;
    if (dateStr) {
      addHistoryEntry(dayKey, workoutCurrentExerciseIndex, dateStr, weight);
      renderDayHistory(dayKey);
      updateChart();
      renderPRs();
      renderHistoryPage();
    }
    if (dayKey === currentDayKey) {
      renderDay(dayKey);
    }
    alert(`× ×©××¨ ××©×§×œ ${weight} ×§×´×’ ×œ-${ex.name}`);
  });

  startRestBtn.addEventListener("click", () => {
    const seconds = parseInt(restSelect.value || "90", 10);
    startRestTimer(seconds);
  });

  // settings
  loadDefaultRest();
  defaultRestSelect.addEventListener("change", saveDefaultRest);
  resetAllDataBtn.addEventListener("click", resetAllData);

  // initial render
  renderDay(currentDayKey);
  populateWorkoutDaySelect();
  populateWorkoutExerciseList();
  renderWorkoutCurrent();
  renderExerciseLibrary();
  renderHistoryPage();
  renderPRs();
</script>
</body>
</html>


